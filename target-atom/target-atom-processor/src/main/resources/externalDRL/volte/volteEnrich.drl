//created on: 2019. 6. 8.

//list any import classes here.
import com.ktds.targetatom.cdr.volte.VoLTEBody;
import com.ktds.targetatom.util.CommonUtils;
import java.lang.StringBuilder;
import java.text.SimpleDateFormat;
import org.slf4j.Logger;
import java.util.Date;
import java.lang.Integer;
import java.util.ArrayList;
import java.lang.String;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import com.ktds.targetatom.bean.AuditHandler;
import com.ktds.targetatom.vo.TbPfixRgnBasInfo;
import com.ktds.targetatom.vo.IntlPfixBasInfo;
import com.ktds.targetatom.vo.WlessSpclNoBasInfo;
import com.ktds.targetatom.vo.TbProfBasInfo;
import com.ktds.targetatom.vo.TbFeatrBasInfo;
import com.ktds.targetatom.vo.TbCalNoBasInfo;
import com.ktds.targetatom.vo.TbNoMovBizrBasInfo;
import com.ktds.targetatom.vo.TbSvcPrvrBasInfo;

//expander customLanguage.dsl

//declare any global variables here
global AuditHandler audit;

function String comnPadChr(String inputString, int length, String padding, String type) {
	inputString = inputString.trim();
	if (inputString.length() >= length) {
		return inputString;
	}
	
	StringBuilder sb = new StringBuilder();
	if (type.equals("L")) {
		while (sb.length() < length - inputString.length()) {
			sb.append(padding);
		}
		sb.append(inputString);
	} else {
		sb.append(inputString);
		while (sb.length() < length) {
			sb.append(padding);
		}
	}
	return sb.toString();
}

function String comnStrTrim(String inputString) {
 
	if (inputString == null || inputString.equals("")){
		return "";
	}
		
	return inputString.trim();
}        

//function void comnTest(VoLTEBody uBody) {
//	uBody.application_release_indicator;
//}  		

rule "populate" salience 50
    dialect "mvel"
    when
    	$uBody : VoLTEBody()
    	eval(true)
    then
//  	comnTest($uBody);
    
    
        $uBody.service_charging_type = comnPadChr($uBody.service_charging_type, 3, "0", "L");
        
        if ($uBody.application_release_indicator == "" || $uBody.application_release_indicator.equals("")) {
    		$uBody.application_release_indicator = 0;
    	}
    	
    	if ($uBody.service_prepaid_airtime_charge.trim().equals(""))
     		$uBody.service_prepaid_airtime_charge = "0";
    	
    	if ($uBody.service_prepaid_information_charge.trim().equals(""))
     		$uBody.service_prepaid_information_charge = "0";
    	
    	if ($uBody.service_prepaid_count_charge.trim().equals(""))
     		$uBody.service_prepaid_count_charge = "0";
     	
     	// uBody.terminating_inter_operator_identifier =
		// comnStrTrim(uBody.terminating_inter_operator_identifier);
    	$uBody.terminating_inter_operator_identifier = comnStrTrim($uBody.terminating_inter_operator_identifier); 
    	// uBody.service_called_information =
		// comnStrTrim(uBody.service_called_information);
    	$uBody.service_called_information = comnStrTrim($uBody.service_called_information);
    
    	// if (comnStrTrim(uBody.service_category_id) == "") {
    	// uBody.service_category_id = "000";
 		// }
    	if (comnStrTrim($uBody.service_category_id) == "" || comnStrTrim($uBody.service_category_id).equals("")) {
    		$uBody.service_category_id = "000";
    	}

    	// listFindIndex 
    	// if (listFindIndex(LST_BIGI_CDR, i, i == uBody.wstype) > -1) {
    	// uBody.bIsBIGI_CDR = true;
    	// }
    	
    	if ($uBody.LST_BIGI_CDR.contains($uBody.wstype)) {
	  		$uBody.bIsBIGI_CDR = true;
	 	}
	 	
	 	// if (listFindIndex(LST_CALL_FORWARDING, i, i ==
		// uBody.supplementary_services_code_1) > -1) {
    	// uBody.bIsCALL_FORWARDING = true;
 		// }
 		if ($uBody.LST_CALL_FORWARDING.contains($uBody.supplementary_services_code_1)) {
  			$uBody.bIsCALL_FORWARDING = true;
 		}
 		
 		int iAppReleaseInd = Integer.parseInt($uBody.application_release_indicator.trim());
    	// if ((listFindIndex(LST_CDF_NORMAL, i, i == iAppReleaseInd) > -1) ||
    	// (iAppReleaseInd <= -200 && iAppReleaseInd >= -299) || (iAppReleaseInd <=
		// -300 && iAppReleaseInd >= -399)) {
    	// uBody.bIsCDF_NORMAL = true;
 		// }
 		
 		// if (iAppReleaseInd == -11) {
    	// uBody.bIsCDF_ABNORMAL = true;
 		// }
 		if (iAppReleaseInd == -11) {
     		$uBody.bIsCDF_ABNORMAL = true;
 		}
 		
 		if ( ($uBody.intContains($uBody.LST_CDF_NORMAL, iAppReleaseInd))  || 
			(iAppReleaseInd <= -200 && iAppReleaseInd >= -299) || 
			(iAppReleaseInd <= -300 && iAppReleaseInd >= -399)) {
  				$uBody.bIsCDF_NORMAL = true;
 		}
 		
 		// if ((listFindIndex(LST_CDF_UNSUCCESS, i, i == iAppReleaseInd) > -1) ||
    	// (iAppReleaseInd <= 499 && iAppReleaseInd >= 400) || (iAppReleaseInd <=
		// 599 && iAppReleaseInd >= 500) ||
    	// (iAppReleaseInd <= 699 && iAppReleaseInd >= 600)) {
    	// uBody.bIsCDF_UNSUCCESS = true;
 		// } else {
    	// uBody.bIsCDF_UNSUCCESS = false;
 		// }
 		
 		if ( ($uBody.intContains($uBody.LST_CDF_UNSUCCESS, iAppReleaseInd)) || 
     		(iAppReleaseInd <= 499 && iAppReleaseInd >= 400) || 
     		(iAppReleaseInd <= 599 && iAppReleaseInd >= 500) || 
     		(iAppReleaseInd <= 699 && iAppReleaseInd >= 600)) {
  				$uBody.bIsCDF_UNSUCCESS = true;
 		} else {
  			$uBody.bIsCDF_UNSUCCESS = false;
 		}
		
 		if ($uBody.wstype.equals($uBody.FPS_CALL)) {
     		$uBody.bIsFPS_CALL = true;
 		}
 		
 		if ($uBody.service_category_id.equals($uBody.IM_3G)) {
     		$uBody.bIsIM_3G = true;
 		}
 		
 		if ($uBody.service_category_id.equals($uBody.IM_4G)) {
     		$uBody.bIsIM_4G = true;
 		}
 
 		if ($uBody.service_category_id.equals($uBody.PSVT_3G_CALL)) {
     		$uBody.bIsPSVT_3G_CALL = true;
 		}
 
 		if ($uBody.service_category_id.equals($uBody.PSVT_4G_CALL)) {
     		$uBody.bIsPSVT_4G_CALL = true;
 		}
 		
 		// if ((listFindIndex(LST_VOLTE_4G_CALL, i, i == uBody.service_category_id)
		// > -1)) {
 		if ($uBody.LST_VOLTE_4G_CALL.contains($uBody.service_category_id)) {
     		$uBody.bIsVOLTE_4G_CALL = true;
 		}
 
 		if ($uBody.service_category_id.equals($uBody.VS_3G_CALL)) {
     		$uBody.bIsVS_3G_CALL = true;
 		}
 
 		if ($uBody.service_category_id.equals($uBody.VS_4G_CALL)) {
     		$uBody.bIsVS_4G_CALL = true;
 		}
 
 		if ($uBody.service_charging_type.equals("004") || $uBody.service_charging_type.equals("006")) {
     		$uBody.bIsTIME_CDR = true;
 		}
 
 		if ($uBody.service_charging_type.equals($uBody.OCR_CDR)) {
     		$uBody.bIsOCR_CDR = true;
 		}
		
		if (!($uBody.wstype.equals($uBody.WIN_CDR))) {
     		$uBody.bIsWIN_CDR = true;
 		}
 
 		if (($uBody.bIsWIN_CDR) && (Integer.parseInt($uBody.service_prepaid_airtime_charge) > 0 || 
     		Integer.parseInt($uBody.service_prepaid_information_charge) > 0 || Integer.parseInt($uBody.service_prepaid_count_charge) > 0)) {
     		$uBody.bIsWIN_CHARGEABLE = true;
 		}
 
 		if (($uBody.bIsVOLTE_4G_CALL) && ($uBody.hd_call.equals("1")) && 
     		(!($uBody.terminating_inter_operator_identifier == null || $uBody.terminating_inter_operator_identifier.equals("") ) && 
     		($uBody.terminating_inter_operator_identifier.startsWith("cs.kt.co") || $uBody.terminating_inter_operator_identifier.startsWith("octave.c"))) ) {
     		$uBody.bIsHD_3G_VOICE = true;
 		}
 		
 		if (($uBody.bIsVOLTE_4G_CALL) && ($uBody.hd_call.equals("1")) && 
     		($uBody.terminating_inter_operator_identifier != null && 
     		($uBody.terminating_inter_operator_identifier.startsWith("ims.kt.c") || 
      		$uBody.terminating_inter_operator_identifier.startsWith("sktims.n") ||
      		$uBody.terminating_inter_operator_identifier.startsWith("lte-lgup"))) ) {
     		$uBody.bIsHD_4G_VOICE = true;
 		}
 
 		if ($uBody.wstype.equals($uBody.BFREE_CALL) || $uBody.wstype.equals($uBody.BRATE_CALL) || $uBody.wstype.equals($uBody.BRRCF_CALL) ||
     		$uBody.wstype.equals($uBody.SMSBG_CALL) || $uBody.wstype.equals($uBody.BLIMIT_CALL) || $uBody.wstype.equals($uBody.BSMOC_CALL) || $uBody.wstype.equals($uBody.BOVER_CALL)) {
     		$uBody.bIsWIN_SRV_BG = true;
 		}
 
 		if ($uBody.service_charging_type.equals("001")){
     		$uBody.bIsNO_CHARGE_CDR = true;
 		}
 
		if ($uBody.bIsNO_CHARGE_CDR && $uBody.bIsWIN_CDR && 
     		($uBody.bIsVOLTE_4G_CALL || $uBody.bIsPSVT_3G_CALL || $uBody.bIsPSVT_4G_CALL || $uBody.bIsVS_3G_CALL || $uBody.bIsVS_4G_CALL)) {
     		$uBody.bIsTIME_CDR_001 = true;
 		}
 
 		if ($uBody.bIsNO_CHARGE_CDR && $uBody.bIsWIN_CDR && ( $uBody.bIsIM_3G || $uBody.bIsIM_4G )) {
     		$uBody.bIsOCR_CDR_001 = true;
     	}
    	
    	if ($uBody.supplementary_services_code_1.equals("227")) {
    		$uBody.bIsEMS_CALLED = true;
 		}
 		
 		
 		$uBody.sCallingSvcNo = CommonUtils.comnSubstring($uBody.charging_number, 0, 11);
 		$uBody.sChrgSvcNo    = $uBody.sCallingSvcNo;
 		// $uBody.setsCallingSvcNo(comnSubstring(volteBody.getCharging_number(), 0,
		// 11));
 		// $uBody.setsChrgSvcNo(enriched.getsCallingSvcNo());
         
        // boolean bIsValidEndDate = strToDate(dConnectingTimeDate,
		// $uBody.service_end_date + $uBody.service_end_time,
		// "yyyyMMddHHmmss");
      	// boolean bIsValidStartDate = strToDate(dConnectingTimeDate,
		// $uBody.service_start_date + $uBody.service_start_time,
		// "yyyyMMddHHmmss");
 		boolean bIsValidEndDate   = CommonUtils.isValidDate($uBody.getService_end_date() + $uBody.getService_end_time(), "yyyyMMddHHmmss");
 		boolean bIsValidStartDate = CommonUtils.isValidDate($uBody.getService_start_date() + $uBody.getService_start_time(), "yyyyMMddHHmmss");
 		
 		if (!(bIsValidEndDate) || !(bIsValidStartDate)) {
	 		$uBody.sCallEndDate  = $uBody.DUMMY_DATE;
     		$uBody.sCallEndTime  = $uBody.DUMMY_TIME1;
     		$uBody.sCallStartDate  = $uBody.DUMMY_DATE;
     		$uBody.sCallStartTime  = $uBody.DUMMY_TIME0;
 		} else {
       	
     		$uBody.sCallStartDate = $uBody.service_start_date;
     		$uBody.sCallStartTime = $uBody.service_start_time;
     		$uBody.sCallEndDate = $uBody.service_end_date;
     		$uBody.sCallEndTime = $uBody.service_end_time;
 		}
 		
 		$uBody.sCalledSvcNo = $uBody.service_called_information;
      	// $uBody.setsCalledSvcNo($uBody.getService_called_information());
      	$uBody.sWorkCalledSvcNo = $uBody.sCalledSvcNo;
      	$uBody.sDrewCalledSvcNo = $uBody.sCalledSvcNo;
		
		// $uBody.setsWorkCalledSvcNo($uBody.getsCalledSvcNo());
        // $uBody.setsDrewCalledSvcNo($uBody.getsCalledSvcNo());
 		
 		// Rule : called_number_vms
      	// if ($uBody.bIsVOLTE_4G_CALL && ($uBody.supplementary_services_code_1 ==
		// "241") &&
        // ((strstartsWith($uBody.service_called_information, "*88") ||
		// (strstartsWith($uBody.service_called_information, "*89"))))) {
        // $uBody.sCalledSvcNo = $uBody.sCallingSvcNo;
      	if ($uBody.bIsVOLTE_4G_CALL && $uBody.supplementary_services_code_1.equals("241") &&
           ($uBody.service_called_information.startsWith("*88") || $uBody.service_called_information.startsWith("*89")))
        	$uBody.sCalledSvcNo = $uBody.sCallingSvcNo;
         	// sCallStartDateTime = $uBody.sCallStartDate + $uBody.sCallStartTime;
       	$uBody.sCallStartDateTime = $uBody.sCallStartDate + $uBody.sCallStartTime;
		if ($uBody.wstype.equals($uBody.PPS_CALL)) {
    	    $uBody.bIsPPS_CALL = true;
     	}
     	// if ($uBody.getWstype().equals(enriched.getPpsCall()))
     	// $uBody.setbIsBIGI_CDR(true);
    
  		if ($uBody.LST_DADAN_CALL.contains($uBody.wstype)) {
        	$uBody.bIsDADAN_CALL = true;
     	}
 		
     	// if ($uBody.getLST_DADAN_CALL().contains($uBody.getWstype()))
     	// $uBody.setbIsDADAN_CALL(true);

     	// RBMS_20150726201256.xml
     	if ($uBody.sCalledSvcNo.startsWith("001") && !($uBody.bIsPPS_CALL || $uBody.bIsDADAN_CALL)) {
        	$uBody.sCallGubun = "IC";
     	} else if ($uBody.bIsPSVT_3G_CALL || $uBody.bIsPSVT_4G_CALL) {
        	$uBody.sCallGubun = "VS";
        	$uBody.bIsVISUAL_CALL = true;
     	} else {
        	$uBody.sCallGubun = "VC";
        	$uBody.bIsVOICE_CALL = true;
     	}     	

	    // if (enriched.getsCalledSvcNo().startsWith("001") &&
		// !(enriched.isbIsPPS_CALL() || enriched.isbIsDADAN_CALL())) {
     	// enriched.setsCallGubun("IC");
     	// } else if (enriched.isbIsPSVT_3G_CALL() ||
		// enriched.isbIsPSVT_4G_CALL()) {
     	// enriched.setsCallGubun("VS");
     	// enriched.setbIsVISUAL_CALL(true);
     	// } else {
     	// enriched.setsCallGubun("VC");
     	// enriched.setbIsVOICE_CALL(true);
     	// }
        // Rule : fix_np_oper_fps
     	// Rule : fix_np_oper_fps_otr
     	// if (listFindIndex(LST_MOBILE_PREFIX, i, i ==
		// $uBody.supplementary_services_code_1) > -1) {
     	if ($uBody.bIsFPS_CALL) {
      		if ($uBody.LST_MOBILE_PREFIX.contains($uBody.supplementary_services_code_1)) {
            	$uBody.sNpInd = "Y";
            	$uBody.sNpOperator = "06";
         	} else {
            	$uBody.sNpInd = "Y";
            	$uBody.sNpOperator = "01";
         	}
     	}
     	
     	
     	// if (enriched.isbIsFPS_CALL()) {
     	// if
		// (enriched.getLST_MOBILE_PREFIX().contains(volteBody.getSupplementary_services_code_1()))
		// {
     	// enriched.setsNpInd("Y");
     	// enriched.setsNpOperator("06");
     	// } else {
     	// enriched.setsNpInd("Y");
     	// enriched.setsNpOperator("01");
     	// }
     	// }
     
     	// Rule : in_network_ind
     	if ($uBody.bIsHD_4G_VOICE) {
        	$uBody.sTermArea = "WL";

         	if ($uBody.terminating_inter_operator_identifier.equals("ims.kt.c")) {
            	$uBody.sInNetCallYn = "Y";
         	} else {
            	$uBody.sInNetCallYn = "N";
         	}
     	}
     	
     	// if (enriched.isbIsHD_4G_VOICE()) {
     	// enriched.setsTermArea("WL");
     	// 
     	// if
		// (volteBody.getTerminating_inter_operator_identifier().equals("ims.kt.c"))
     	// enriched.setsInNetCallYn("Y");
     	// else
     	// enriched.setsInNetCallYn("N");
     	// }
      	// Rule : input_file_type_assignment

     	// Rule : np_information
     	String sPreRoutingNumber = comnStrTrim(CommonUtils.comnSubstring($uBody.routing_number, 0, 2));

     	if (!(sPreRoutingNumber.equals("") || sPreRoutingNumber == null)) {
        	$uBody.sNpInd = "Y";
        	$uBody.sNpOperator = comnPadChr(sPreRoutingNumber, 2, "0", "L");
     	}
     	
     	// Rule : np_information_exception -
		// RBMS_20150726201256.xml
      
     	if (sPreRoutingNumber.equals("") || sPreRoutingNumber == null) {
        	if (($uBody.supplementary_services_code_1.equals("241")) && ($uBody.service_category_id.equals("611") || $uBody.service_category_id.equals("000"))) {
            	$uBody.terminating_inter_operator_identifier = "ims.kt.c";
         	}

         	if ($uBody.terminating_inter_operator_identifier.equals("ims.kt.c")) {
            	$uBody.sNpOperator = "13";
            	$uBody.sNpInd = "Y";
         	} else if ($uBody.terminating_inter_operator_identifier.equals("octave.c")) {
            	$uBody.sNpOperator = "15";
             	$uBody.sNpInd = "Y";
         	}
     	}
     	
     	if ($uBody.bIsPSVT_4G_CALL || $uBody.bIsPSVT_3G_CALL) {
        	$uBody.sKeyVal = "OTR";
     	} else {
        	$uBody.sKeyVal = "ORG";
     	}
     	
     	
     	// sTmpCalledSvcNo = strREReplaceAll($uBody.sCalledSvcNo, "\\*", "");
     	// sTmpCalledSvcNo = strREReplaceAll(sTmpCalledSvcNo, "#", "");
     	// if (sTmpCalledSvcNo != null) {
     	// sTmpCalledSvcNo = strREIndexOf(sTmpCalledSvcNo, "[^0-9]") < 0 ?
		// sTmpCalledSvcNo : comnSubstring (sTmpCalledSvcNo, 0,
		// strREIndexOf(sTmpCalledSvcNo, "[^0-9]"));
     	// }
     	String sTmpCalledSvcNo ="";
     	
       	if ( !($uBody.sCalledSvcNo == null || $uBody.sCalledSvcNo.equals("")) ) {
      		sTmpCalledSvcNo = $uBody.sCalledSvcNo;
      		sTmpCalledSvcNo = CommonUtils.strREIndexOf(sTmpCalledSvcNo) < 0 ? sTmpCalledSvcNo : CommonUtils.comnSubstring(sTmpCalledSvcNo, 0, CommonUtils.strREIndexOf(sTmpCalledSvcNo));
     	}
     
     	// TB_PFIX_RGN_BAS_Intl uTB_PFIX_RGN_BAS =
		// get_TB_PFIX_RGN_BAS(sTmpCalledSvcNo,
		// enriched.getsCallStartDateTime(), $uBody.sKeyVal);
     	// if (uTB_PFIX_RGN_BAS.lRowCnt > 0) {
     	// $uBody.sSettlFileName = uTB_PFIX_RGN_BAS.sSettlFileName; // ex) KTF
		// WORK.sett_fname
     	// $uBody.sSettlCarrier = uTB_PFIX_RGN_BAS.sSettlCarrier; // ex) KTF
		// WORK.sett_provider
     	// $uBody.sSettlFeatureCd = uTB_PFIX_RGN_BAS.sSettlFeatureCd; // ex)
		// KTF010 WORK.sett_feature
     	// $uBody.sCalledArea = uTB_PFIX_RGN_BAS.sNpaAreaNo; // ex) 010
		// WORK.called_area
     	// $uBody.sChrgOtherNo = uTB_PFIX_RGN_BAS.sChrgOtherNo; // ex) 1032164062
		// WORK.tn_called_number
     	// $uBody.sInNetCallYn = uTB_PFIX_RGN_BAS.sInNetCallYn; // ex) Y
		// WORK.in_network_ind
     	// $uBody.sTermArea = uTB_PFIX_RGN_BAS.sWiredLessDivideValue; // ex) WL
		// WORK.term_area
     	// }
     	//System.out.println("sTmpCalledSvcNo ::: {" + sTmpCalledSvcNo + "} ::: getsCallStartDateTime ::: {" + $uBody.getsCallStartDateTime() + "} ::: getsKeyVal ::: {" + $uBody.getsKeyVal() + "}");
     	TbPfixRgnBasInfo tbPfixRgnBasInfo = audit.get_TB_PFIX_RGN_BAS(sTmpCalledSvcNo, $uBody.getsCallStartDateTime(), $uBody.sKeyVal);
     
      	if (tbPfixRgnBasInfo != null ) {
       		$uBody.setsSettlFileName(tbPfixRgnBasInfo.getsSettlFileName());
       		$uBody.setsSettlCarrier(tbPfixRgnBasInfo.getsSettlCarrier());
      		$uBody.setsSettlFeatureCd(tbPfixRgnBasInfo.getsSettlFeatureCd());
       		$uBody.setsCalledArea(tbPfixRgnBasInfo.getsNpaAreaNo());
       		$uBody.setsInNetCallYn(tbPfixRgnBasInfo.getsInNetCallYn());
       		$uBody.setsChrgOtherNo(tbPfixRgnBasInfo.getsChrgOtherNo());
       		$uBody.setsTermArea(tbPfixRgnBasInfo.getsWiredLessDivideValue());
      	}
      	
      	// if (sPreRoutingNumber.equals("") || sPreRoutingNumber == null) {
     	// if (volteBody.getSupplementary_services_code_1().equals("241") &&
     	// (volteBody.getService_category_id().equals("611") ||
		// volteBody.getService_category_id().equals("000")))
     	// volteBody.setTerminating_inter_operator_identifier("ims.kt.c");
     	// 
     	// if
		// (volteBody.getTerminating_inter_operator_identifier().equals("ims.kt.c"))
		// {
     	// enriched.setsNpOperator("13");
     	// enriched.setsNpInd("Y");
     	// } else if
		// (volteBody.getTerminating_inter_operator_identifier().equals("octave.c"))
		// {
     	// enriched.setsNpOperator("15");
     	// enriched.setsNpInd("Y");
     	// }
     	// }
 
     	// Rule : prefix_area
     	// IF (PSVT_4G_CALL OR PSVT_3G_CALL) THEN WORK.key_val="OTR" ELSE
		// WORK.key_val="ORG";
     	// VOLTE.service_category_id = "612" || VOLTE.service_category_id =
		// "622"
     	if ($uBody.bIsPSVT_4G_CALL || $uBody.bIsPSVT_3G_CALL) {
         	$uBody.sKeyVal = "OTR";
     	} else {
         	$uBody.sKeyVal = "ORG";
     	}
     	// if (enriched.isbIsPSVT_4G_CALL() || enriched.isbIsPSVT_3G_CALL())
     	// enriched.setsKeyVal("OTR");
     	// else
     	// enriched.setsKeyVal("ORG");
       
     	// string sTmpCalledSvcNo = $uBody.sCalledSvcNo;
     
     	String sTmpCalledSvcNo = "";
     	//System.out.println("sCalledSvcNo ::: " + $uBody.sCalledSvcNo);
        //sTmpCalledSvcNo = $uBody.sCalledSvcNo.replace(/\*/gi, "");
     	
    	// RBMS_20150726201256.xml
     	if ($uBody.bIsTIME_CDR || $uBody.bIsTIME_CDR_001) {
        	$uBody.sProdFormatId = "VOLTE";
        	$uBody.sProdCdType = $uBody.sCallGubun;
        	$uBody.sInsProdType = "SCP";
     	}
     	// if (enriched.isbIsTIME_CDR() || enriched.isbIsTIME_CDR_001()) {
     	// enriched.setsProdFormatId("VOLTE");
     	// enriched.setsProdCdType(enriched.getsCallGubun());
     	// enriched.setsInsProdType("SCP");
     	// }
     
     	// RBMS_20150726201256.xml
     	if ($uBody.bIsOCR_CDR || $uBody.bIsOCR_CDR_001) {
        	$uBody.sProdFormatId = "VOLTE";
         	$uBody.sProdCdType = "";
         	$uBody.sProdNumber = $uBody.wstype;
         	$uBody.sInsProdType = "WIN";
     	}
     	
     	// if (enriched.isbIsOCR_CDR() || enriched.isbIsOCR_CDR_001()) {
  		// enriched.setsProdFormatId("VOLTE");
     	// enriched.setsProdCdType("");
     	// enriched.setsProdNumber(volteBody.getWstype());
     	// enriched.setsInsProdType("WIN");
     	// }
  
     	// Rule : set_cdf_abnorm
     	if ($uBody.bIsCDF_ABNORMAL) {
        	$uBody.sTermCode = $uBody.CDF_ABNORM_V;
         	$uBody.bIsABNORMAL_COMP = true;
     	}
     	
     	// if (enriched.isbIsCDF_ABNORMAL()) {
     	// enriched.setsTermCode(enriched.getCdfAbnormV());
     	// enriched.setbIsABNORMAL_COMP(true);
     	// }

     	// Rule : set_cdf_norm
     	if ($uBody.bIsCDF_NORMAL) {
         	$uBody.sTermCode = $uBody.getCdfNormV();
         	$uBody.bIsNORMAL_COMP = true;
     	}
     	
     	// if (enriched.isbIsCDF_NORMAL()) {
     	// enriched.setsTermCode(enriched.getCdfNormV());
     	// enriched.setbIsNORMAL_COMP(true);
     	// }

     	// Rule : set_cdf_unsuccess

     	if (!($uBody.bIsCDF_ABNORMAL || $uBody.bIsCDF_NORMAL)) {
         	$uBody.sTermCode = $uBody.getCdfUnsuccessV();
         	$uBody.bIsUNSUCCESS_COMP = true;
     	}
      	
      	// if (!(enriched.isbIsCDF_ABNORMAL() || enriched.isbIsCDF_NORMAL())) {
     	// enriched.setsTermCode(enriched.getCdfUnsuccessV());
     	// enriched.setbIsUNSUCCESS_COMP(true);
     	// }
     	// Rule : set_win
     	if ($uBody.bIsWIN_CDR) {
         	$uBody.sWinSvcType = $uBody.wstype;
     	}
     	
     	// if (enriched.isbIsWIN_CDR())
     	// enriched.setsWinSvcType(volteBody.getWstype());

     	$uBody.sCallingIp = $uBody.calling_asserted_identity;
  		// enriched.setsCallingIp(volteBody.getCalling_asserted_identity());
     	// Rule : sscode
     	$uBody.sSscode = $uBody.supplementary_services_code_1;
  		// enriched.setsSscode(volteBody.getSupplementary_services_code_1());
		// RBMS_20150726201256.xml
     
     	// VOLTE.INTERNATIONAL
     	//if (uBody.sCalledSvcNo.startsWith("00") && !(uBody.sSscode == SSCODE_FREE_ZONE)) {
      	if ($uBody.sCalledSvcNo.startsWith("00") && !($uBody.sSscode.equals($uBody.SSCODE_FREE_ZONE))) {
         	$uBody.bIsINTERNATIONAL = true;
     	}
     	
     	// if (enriched.getsCalledSvcNo().startsWith("00") &&
		// !enriched.getsSscode().equals(enriched.getSscodeFreeZone()))
     	// enriched.setbIsINTERNATIONAL(true);
     
     	if ($uBody.bIsINTERNATIONAL) {
         	$uBody.sSpNumberType = $uBody.getSpip();
     	} else {
         	$uBody.sSpNumberType = $uBody.getSpnm();
     	}
     	// if (enriched.isbIsINTERNATIONAL())
     	// enriched.setsSpNumberType(enriched.getSpip());
     	// else
     	// enriched.setsSpNumberType(enriched.getSpnm());

     	// Rule : special_number_yn
     	$uBody.sSpIndi = "N"; 
						
     	// enriched.setsSpIndi("N");
     	//   
		// 
		// //TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_1 =
		// get_TB_WLESS_SPCL_NO_BAS(uBody.sCalledArea, uBody.sChrgOtherNo, "KTF",
		// enriched.getsCallStartDateTime(), uBody.sSpNumberType);
		// WlessSpclNoBasInfo uTB_WLESS_SPCL_NO_BAS_1 =
		// audit.get_TB_WLESS_SPCL_NO_BAS(enriched.getsCalledArea(),
		// enriched.getsChrgOtherNo(), "KTF", enriched.getsCallStartDateTime(),
		// enriched.getsSpNumberType());
		//
		// //if (uTB_WLESS_SPCL_NO_BAS_1.lRowCnt > 0) {
		// // uBody.sSpIndi = "Y";
		// //}
		// if (uTB_WLESS_SPCL_NO_BAS_1 != null ) {
		// enriched.setsSpIndi("Y");
		// }
     
     	// Rule : usage_domain
     	$uBody.sChrgCallYn = "Y";
  		// enriched.setsChrgCallYn("Y");
     	// Rule : vms_access
     	// if (listFindIndex(LST_SSCODE_VMS, i, i == uBody.sSscode) > -1) {
     	// uBody.sVmsAccess = "00";
     	// uBody.sVmsInd = "Y";
     	// }
     	if ($uBody.LST_SSCODE_VMS.contains($uBody.sSscode)) {
      		$uBody.setsVmsAccess("00");
      		$uBody.setsVmsInd("Y");
     	}
     	
     	// rule "Setting Volte Edit" salience 20
		// //include attributes such as "salience" here...
		// when
		// volteBody : VoLTEBody ()
		// eval(true)
		// then
		// // Rule : called_number_freezone
		// RBMS_20150726201256.xml
		//   
     
     	if ($uBody.service_called_information.startsWith("0995")) {
         	$uBody.bIsPREFIX_FREEZONE = true;
     	}
     	// if (volteBody.getService_called_information().startsWith("0995"))
     	// enriched.setbIsPREFIX_FREEZONE(true);

     	if ($uBody.sSscode.equals($uBody.getSscodeFreeZone()) && $uBody.bIsPREFIX_FREEZONE) {
         	$uBody.sCalledSvcNo = CommonUtils.comnSubstring($uBody.sCalledSvcNo,7,18);
         	$uBody.sWorkCalledSvcNo = $uBody.sCalledSvcNo;
     	}
     	// if (enriched.getsSscode().equals(enriched.getSscodeFreeZone()) &&
		// enriched.isbIsPREFIX_FREEZONE()) {
     	// enriched.setsCalledSvcNo(comnSubstring(enriched.getsCalledSvcNo(), 7,
		// 18));
     	// enriched.setsWorkCalledSvcNo(enriched.getsCalledSvcNo());

     	// }
     	
       	if ($uBody.sSscode.equals($uBody.getSscodeFreeZone()) && $uBody.bIsPREFIX_FREEZONE) {
        	if ($uBody.bIsVISUAL_CALL) {
            	$uBody.sKeyVal = "OTR";
         	} else {
             	$uBody.sKeyVal = "ORG";
        	}
     		
     		TbPfixRgnBasInfo tbPfixRgnBas = audit.get_TB_PFIX_RGN_BAS("01029445555", $uBody.getsCallStartDateTime(), $uBody.getsKeyVal());
       
       		if (tbPfixRgnBas != null ) {
        		$uBody.setsSettlFileName(tbPfixRgnBas.getsSettlFileName());
        		$uBody.setsSettlCarrier(tbPfixRgnBas.getsSettlCarrier());
        		$uBody.setsSettlFeatureCd(tbPfixRgnBas.getsSettlFeatureCd());
        		$uBody.setsCalledArea(tbPfixRgnBas.getsNpaAreaNo());
        		$uBody.setsChrgOtherNo(tbPfixRgnBas.getsChrgOtherNo());
        		$uBody.setsInNetCallYn(tbPfixRgnBas.getsInNetCallYn());
        		$uBody.setsTermArea(tbPfixRgnBas.getsWiredLessDivideValue());
    		}
   		}
		
		if ($uBody.sSpIndi.equals("Y") && $uBody.bIsINTERNATIONAL) {
         	$uBody.bIsINTL_SERVICE_PROVIDER = true;
     	}
     	// if (enriched.getsSpIndi().equals("Y") &&
		// enriched.isbIsINTERNATIONAL())
     	// enriched.setbIsINTL_SERVICE_PROVIDER(true);

     	// if (strstartsWith($uBody.sCalledSvcNo,"001") && !($uBody.bIsPPS_CALL ||
		// $uBody.bIsDADAN_CALL)) {
     	// TB_INTL_PFIX_BAS_Intl uTB_INTL_PFIX_BAS =
		// get_TB_INTL_PFIX_BAS($uBody.sChrgOtherNo);
     	// if ( uTB_INTL_PFIX_BAS.lRowCnt > 0 ) {
     	// $uBody.sNationCd = uTB_INTL_PFIX_BAS.sIntlPrefixCd; // country_code
     	// $uBody.sSecondNationCd = uTB_INTL_PFIX_BAS.sSubIntlPrefixCd; //
		// fic_country_code
     	// }
     	// }
     
     	if ($uBody.getsCalledSvcNo().startsWith("001") && !($uBody.isbIsPPS_CALL() || $uBody.isbIsDADAN_CALL())) {
   			IntlPfixBasInfo tbIntlPfixBas = audit.get_TB_INTL_PFIX_BAS($uBody.getsChrgOtherNo());
   
   			if (tbIntlPfixBas != null ) {
    			$uBody.setsNationCd(tbIntlPfixBas.getsIntlPrefixCd());
    			$uBody.setsSecondNationCd(tbIntlPfixBas.getsSubIntlPrefixCd());
   			}
  		}

      	if ($uBody.bIsTIME_CDR || $uBody.bIsTIME_CDR_001) {
     	
      	}  
     
     	// Rule : format_id
     	// $uBody.sFormatId = sFileType;

     	$uBody.setsFormatId($uBody.getsFileType()); // ==> sFileType?
     	// Rule : get_fps_open_date
     	// TB_PROF_BAS_Intl uTB_PROF_BAS_1 = get_TB_PROF_BAS("FPS_OPEN_DATE",
		// "VOLTE", enriched.getsCallStartDateTime());

     	// if (!(uTB_PROF_BAS_1 == null)) {
     	// $uBody.sProfileResult = uTB_PROF_BAS_1.sReturnValue;
     	// $uBody.sFpsResult = uTB_PROF_BAS_1.sReturnValue;
     	// }  
  		TbProfBasInfo tmpTbProfBas = audit.get_TB_PROF_BAS("FPS_OPEN_DATE", "VOLTE", $uBody.getsCallStartDateTime());
  
  		if (tmpTbProfBas != null ) {
   			$uBody.setsProfileResult(tmpTbProfBas.getsReturnvalue());
   			$uBody.setsFpsResult(tmpTbProfBas.getsReturnvalue());
  		}

     	// Rule : get_vms_access_date
     	// TB_PROF_BAS_Intl uTB_PROF_BAS_2 = get_TB_PROF_BAS($uBody.sVmsIdent,
		// $uBody.sVmsDivision, enriched.getsCallStartDateTime());
  		//
     	// if (!(uTB_PROF_BAS_2 == null)) {
     	// $uBody.sProfileResult = uTB_PROF_BAS_2.sReturnValue;
     	// $uBody.sVmsResult = uTB_PROF_BAS_2.sReturnValue;
     	// }
     	tmpTbProfBas = audit.get_TB_PROF_BAS($uBody.getSvmsident(), $uBody.getSvmsdivision(), $uBody.getsCallStartDateTime());
     
     	if (tmpTbProfBas != null ) {
      		$uBody.setsProfileResult(tmpTbProfBas.getsReturnvalue());
      		$uBody.setsVmsResult(tmpTbProfBas.getsReturnvalue());
     	}
      
     	// Rule : get_vms_feature_change_date
     	// TB_PROF_BAS_Intl uTB_PROF_BAS_3 = get_TB_PROF_BAS($uBody.sIpasIdent,
		// $uBody.sIpasDivision, enriched.getsCallStartDateTime());

     	// if (!(uTB_PROF_BAS_3 == null)) {
     	// $uBody.sProfileResult = uTB_PROF_BAS_3.sReturnValue;
     	// $uBody.sIpasResult = uTB_PROF_BAS_3.sReturnValue;
     	// }
     	tmpTbProfBas = audit.get_TB_PROF_BAS($uBody.getSipasident(), $uBody.getSipasdivision(), $uBody.getsCallStartDateTime());
     
     	if (tmpTbProfBas != null ) {
      		$uBody.setsProfileResult(tmpTbProfBas.getsReturnvalue());
      		$uBody.setsVmsResult(tmpTbProfBas.getsReturnvalue());
  		}
      
     	// if ((!($uBody.sSpIndi == "Y") && ($uBody.sNpInd == "Y") &&
		// !$uBody.bIsINTERNATIONAL) && ($uBody.bIsVOICE_CALL)) {

     	// $uBody.sNpSettProvider = $uBody.sSettlCarrier;
     	// $uBody.sNpSettFeature = $uBody.sSettlFeatureCd;

     	// TB_NO_MOV_BIZR_BAS_Intl uTB_NO_MOV_BIZR_BAS =
		// getTB_NO_MOV_BIZR_BAS($uBody.sNpOperator,
		// enriched.getsCallStartDateTime(), $uBody.sSpIndi, "ORG",
		// $uBody.sChrgOtherNo);

     	// if (uTB_NO_MOV_BIZR_BAS.lRowCnt > 0) {
     	// $uBody.sSettlFileName = uTB_NO_MOV_BIZR_BAS.sSettlFileName;
		// //WORK.sett_fname
     	// $uBody.sSettlCarrier = uTB_NO_MOV_BIZR_BAS.sNpSettlCarrier;
		// //WORK.sett_provider
     	// $uBody.sSettlFeatureCd = uTB_NO_MOV_BIZR_BAS.sSettlFeatureCd;
		// //WORK.sett_feature
     	// $uBody.sInNetCallYn = uTB_NO_MOV_BIZR_BAS.sInNetCallYn;
		// //WORK.in_network_ind
     	// }

     	// }
     
   		if ((!($uBody.getsSpIndi().equals("Y")) && ($uBody.getsNpInd().equals("Y")) && !$uBody.isbIsINTERNATIONAL()) && ($uBody.isbIsVOICE_CALL())) {
    		$uBody.setsNpSettProvider($uBody.getsSettlCarrier());
    		$uBody.setsNpSettFeature($uBody.getsSettlFeatureCd());
    
    		TbNoMovBizrBasInfo tbNoMovBizrBas = audit.get_TB_NO_MOV_BIZR_BAS($uBody.getsNpOperator(), $uBody.getsCallStartDateTime(), $uBody.getsSpIndi(), "ORG", $uBody.getsChrgOtherNo());
    
    		if (tbNoMovBizrBas != null ) {
     			$uBody.setsSettlFileName(tbNoMovBizrBas.getsSettlFileName());
     			$uBody.setsSettlCarrier(tbNoMovBizrBas.getsNpSettlCarrier());
     			$uBody.setsSettlFeatureCd(tbNoMovBizrBas.getsSettlFeatureCd());
     			$uBody.setsInNetCallYn(tbNoMovBizrBas.getsInNetCallYn());
       		}
      	}
      	

     	// if ((!($uBody.sSpIndi == "Y") && ($uBody.sNpInd == "Y") &&
		// !$uBody.bIsINTERNATIONAL) && $uBody.bIsVISUAL_CALL) {
     	// $uBody.sNpSettProvider = $uBody.sSettlCarrier;
     	// $uBody.sNpSettFeature = $uBody.sSettlFeatureCd;

     	// TB_NO_MOV_BIZR_BAS_Intl uTB_NO_MOV_BIZR_BAS =
		// getTB_NO_MOV_BIZR_BAS($uBody.sNpOperator,
		// enriched.getsCallStartDateTime(), $uBody.sSpIndi, "OTR",
		// $uBody.sChrgOtherNo);

     	// if (uTB_NO_MOV_BIZR_BAS.lRowCnt > 0) {
     	// $uBody.sSettlFileName = uTB_NO_MOV_BIZR_BAS.sSettlFileName;
		// //WORK.sett_fname
     	// $uBody.sSettlCarrier = uTB_NO_MOV_BIZR_BAS.sNpSettlCarrier;
		// //WORK.sett_provider
     	// $uBody.sSettlFeatureCd = uTB_NO_MOV_BIZR_BAS.sSettlFeatureCd;
		// //WORK.sett_feature
     	// $uBody.sInNetCallYn = uTB_NO_MOV_BIZR_BAS.sInNetCallYn;
		// //WORK.in_network_ind
     	// }
     	// }
     
      	if ((!($uBody.getsSpIndi().equals("Y")) && ($uBody.getsNpInd().equals("Y") && !$uBody.isbIsINTERNATIONAL()) && $uBody.isbIsVISUAL_CALL())) {
       		$uBody.setsNpSettProvider($uBody.getsSettlCarrier());
       		$uBody.setsNpSettFeature($uBody.getsSettlFeatureCd());
       
       		TbNoMovBizrBasInfo tbNoMovBizrBas = audit.get_TB_NO_MOV_BIZR_BAS($uBody.getsNpOperator(), $uBody.getsCallStartDateTime(), $uBody.getsSpIndi(), "OTR", $uBody.getsChrgOtherNo());
       
       		if (tbNoMovBizrBas != null ) {
        		$uBody.setsSettlFileName(tbNoMovBizrBas.getsSettlFileName());
        		$uBody.setsSettlCarrier(tbNoMovBizrBas.getsNpSettlCarrier());
        		$uBody.setsSettlFeatureCd(tbNoMovBizrBas.getsSettlFeatureCd());
        		$uBody.setsInNetCallYn(tbNoMovBizrBas.getsInNetCallYn());
       		}
      	}
     
     	// if (((uBody.sSpIndi == "Y") && (!(uBody.sNpInd == "Y") &&
		// !uBody.bIsINTERNATIONAL) && (uBody.bIsVOICE_CALL))) {
     	// TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_2 =
		// get_TB_WLESS_SPCL_NO_BAS(uBody.sCalledArea, uBody.sChrgOtherNo,
		// "KTF", enriched.getsCallStartDateTime(), SPNM);
     	// if (uTB_WLESS_SPCL_NO_BAS_2.lRowCnt > 0) {
     	// uBody.sSettlFileName = uTB_WLESS_SPCL_NO_BAS_2.sSettlFileName;
     	// uBody.sSettlFeatureCd = uTB_WLESS_SPCL_NO_BAS_2.sSettlFeatureCd; //
		// ORG �� ���
     	// uBody.sSettlCarrier = uTB_WLESS_SPCL_NO_BAS_2.sSettlCarrier;
     	// uBody.sIntlNxx = uTB_WLESS_SPCL_NO_BAS_2.sNxxNo;
     	// uBody.sInNetCallYn = uTB_WLESS_SPCL_NO_BAS_2.sInNetCallYn;
     	// }
     	// if (uBody.sInNetCallYn == null || uBody.sInNetCallYn == "") {
     	// uBody.sInNetCallYn = "N";
     	// }
     	// }
   		if ((($uBody.getsSpIndi().equals("Y")) && (!($uBody.getsNpInd().equals("Y") && !$uBody.isbIsINTERNATIONAL()) && $uBody.isbIsVOICE_CALL()))) {
   			WlessSpclNoBasInfo tbWlessSpclNoBas2 = audit.get_TB_WLESS_SPCL_NO_BAS($uBody.getsCalledArea(), $uBody.getsChrgOtherNo(), "KTF", $uBody.getsCallStartDateTime(), $uBody.getSpnm());
    
    		if (tbWlessSpclNoBas2 != null ) {
     			$uBody.setsSettlFileName(tbWlessSpclNoBas2.getsSettlFileName());
     			$uBody.setsSettlFeatureCd(tbWlessSpclNoBas2.getsSettlFeatureCd());
     			$uBody.setsSettlCarrier(tbWlessSpclNoBas2.getsSettlCarrier());
     			$uBody.setsIntlNxx(tbWlessSpclNoBas2.getsNxxNo());
     			$uBody.setsInNetCallYn(tbWlessSpclNoBas2.getsInNetCallYn());
    		}
    		if ($uBody.getsInNetCallYn() == null || $uBody.getsInNetCallYn().equals("")) {
     			$uBody.setsInNetCallYn("N");
    		}
   		}
     
     	// if ((($uBody.sSpIndi == "Y") && (!($uBody.sNpInd == "Y") &&
		// !$uBody.bIsINTERNATIONAL) && ($uBody.bIsVISUAL_CALL))) {
     	// TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_3 =
		// get_TB_WLESS_SPCL_NO_BAS($uBody.sCalledArea, $uBody.sChrgOtherNo,
		// "KTF", enriched.getsCallStartDateTime(), SPNM);
         
     	// if (uTB_WLESS_SPCL_NO_BAS_3.lRowCnt > 0) {
     	// $uBody.sSettlFileName = uTB_WLESS_SPCL_NO_BAS_3.sSettlFileName;
     	// $uBody.sSettlFeatureCd = uTB_WLESS_SPCL_NO_BAS_3.sSettlFeatureType; //
		// "OTR"
     	// $uBody.sSettlCarrier = uTB_WLESS_SPCL_NO_BAS_3.sSettlCarrier;
     	// $uBody.sIntlNxx = uTB_WLESS_SPCL_NO_BAS_3.sNxxNo;
     	// $uBody.sInNetCallYn = uTB_WLESS_SPCL_NO_BAS_3.sInNetCallYn;
     	// }

     	// if ($uBody.sInNetCallYn == null || $uBody.sInNetCallYn == "") {
     	// $uBody.sInNetCallYn = "N";
     	// }
     	// }
      	if ((($uBody.getsSpIndi().equals("Y")) && (!($uBody.getsNpInd().equals("Y") && !$uBody.isbIsINTERNATIONAL()) && $uBody.isbIsVISUAL_CALL()))) {
    		WlessSpclNoBasInfo tbWlessSpclNoBas3 = audit.get_TB_WLESS_SPCL_NO_BAS($uBody.getsCalledArea(), $uBody.getsChrgOtherNo(), "KTF", $uBody.getsCallStartDateTime(), $uBody.getSpnm());
    
    		if (tbWlessSpclNoBas3 != null ) {
     			$uBody.setsSettlFileName(tbWlessSpclNoBas3.getsSettlFileName());
     			$uBody.setsSettlFeatureCd(tbWlessSpclNoBas3.getsSettlFeatureCd());
     			$uBody.setsSettlCarrier(tbWlessSpclNoBas3.getsSettlCarrier());
     			$uBody.setsIntlNxx(tbWlessSpclNoBas3.getsNxxNo());
     			$uBody.setsInNetCallYn(tbWlessSpclNoBas3.getsInNetCallYn());
    		}
    		if ($uBody.getsInNetCallYn() == null || $uBody.getsInNetCallYn().equals("")) {
     			$uBody.setsInNetCallYn("N");
    		}
   		}
     
     	// if (($uBody.sSpIndi == "Y") && ($uBody.sNpInd == "Y") &&
		// !$uBody.bIsINTERNATIONAL && ($uBody.bIsVOICE_CALL)) {

     	// $uBody.sNpSettProvider = $uBody.sSettlCarrier;
     	// $uBody.sNpSettFeature = $uBody.sSettlFeatureCd;
         
     	// TB_NO_MOV_BIZR_BAS_Intl uTB_NO_MOV_BIZR_BAS =
		// getTB_NO_MOV_BIZR_BAS($uBody.sNpOperator,
		// enriched.getsCallStartDateTime(), $uBody.sSpIndi, "ORG",
		// $uBody.sChrgOtherNo);

     	// if (uTB_NO_MOV_BIZR_BAS.lRowCnt > 0) {
     	// $uBody.sSettlFileName = uTB_NO_MOV_BIZR_BAS.sSettlFileName;
		// //WORK.sett_fname
     	// $uBody.sSettlCarrier = uTB_NO_MOV_BIZR_BAS.sNpSettlCarrier;
		// //WORK.sett_provider
     	// $uBody.sSettlFeatureCd = uTB_NO_MOV_BIZR_BAS.sSettlFeatureCd;
		// //WORK.sett_feature
     	// $uBody.sInNetCallYn = uTB_NO_MOV_BIZR_BAS.sInNetCallYn;
		// //WORK.in_network_ind
     	// }
     	// TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_4 =
		// get_TB_WLESS_SPCL_NO_BAS($uBody.sCalledArea, $uBody.sChrgOtherNo,
		// "KTF", enriched.getsCallStartDateTime(), SPNM);
         
     	// if (uTB_WLESS_SPCL_NO_BAS_4.lRowCnt > 0) {
     	// $uBody.sSettlFeatureCd = uTB_WLESS_SPCL_NO_BAS_4.sSettlFeatureType;
     	// }
     
      	if ((!($uBody.getsSpIndi().equals("Y")) && ($uBody.getsNpInd().equals("Y") && !$uBody.isbIsINTERNATIONAL()) && $uBody.isbIsVOICE_CALL())) {
       		$uBody.setsNpSettProvider($uBody.getsSettlCarrier());
       		$uBody.setsNpSettFeature($uBody.getsSettlFeatureCd());
       
       		TbNoMovBizrBasInfo tbNoMovBizrBas = audit.get_TB_NO_MOV_BIZR_BAS($uBody.getsNpOperator(), $uBody.getsCallStartDateTime(), $uBody.getsSpIndi(), "ORG", $uBody.getsChrgOtherNo());
       
       		if (tbNoMovBizrBas != null ) {
        		$uBody.setsSettlFileName(tbNoMovBizrBas.getsSettlFileName());
        		$uBody.setsSettlCarrier(tbNoMovBizrBas.getsNpSettlCarrier());
        		$uBody.setsSettlFeatureCd(tbNoMovBizrBas.getsSettlFeatureCd());
        		$uBody.setsInNetCallYn(tbNoMovBizrBas.getsInNetCallYn());
       		}
       
       		WlessSpclNoBasInfo tbWlessSpclNoBas4 = audit.get_TB_WLESS_SPCL_NO_BAS($uBody.getsCalledArea(), $uBody.getsChrgOtherNo(), "KTF", $uBody.getsCallStartDateTime(), $uBody.getSpnm());
    
    		if (tbWlessSpclNoBas4 != null ) {
     			$uBody.setsSettlFeatureCd(tbWlessSpclNoBas4.getsSettlFeatureCd());
    		}
      	}

     
    	// RBMS_20150726201256.xml
     
     	// if (($uBody.sSpIndi == "Y") && ($uBody.sNpInd == "Y") &&
		// !$uBody.bIsINTERNATIONAL && ($uBody.bIsVOICE_CALL)) {
     	// if (!($uBody.sCalledSvcNo == null || $uBody.sCalledSvcNo == "") &&
		// (!(listFindIndex(LST_MOBILE_PREFIX, i, i ==
		// comnSubstring($uBody.sCalledSvcNo, 0, 3)) > -1))) {
     	// $uBody.sNpSettProvider = $uBody.sSettlCarrier;
     	// $uBody.sNpSettFeature = $uBody.sSettlFeatureCd;

     	// TB_NO_MOV_BIZR_BAS_Intl uTB_NO_MOV_BIZR_BAS =
		// getTB_NO_MOV_BIZR_BAS($uBody.sNpOperator,
		// enriched.getsCallStartDateTime(), $uBody.sSpIndi, "ORG",
		// $uBody.sChrgOtherNo);

     	// if (uTB_NO_MOV_BIZR_BAS.lRowCnt > 0) {
     	// $uBody.sSettlFileName = uTB_NO_MOV_BIZR_BAS.sSettlFileName;
		// //WORK.sett_fname
     	// $uBody.sSettlCarrier = uTB_NO_MOV_BIZR_BAS.sNpSettlCarrier;
		// //WORK.sett_provider
     	// $uBody.sSettlFeatureCd = uTB_NO_MOV_BIZR_BAS.sSettlFeatureCd;
		// //WORK.sett_feature
     	// $uBody.sInNetCallYn = uTB_NO_MOV_BIZR_BAS.sInNetCallYn;
		// //WORK.in_network_ind
     	// }

     	// }
     	// }
     
      	if ((!($uBody.getsSpIndi().equals("Y")) && ($uBody.getsNpInd().equals("Y") && !$uBody.isbIsINTERNATIONAL()) && $uBody.isbIsVOICE_CALL())) {
       		if (!($uBody.getsCalledSvcNo() == null || $uBody.getsCalledSvcNo().equals("")) && 
          		(!($uBody.LST_MOBILE_PREFIX.contains(CommonUtils.comnSubstring($uBody.sCalledSvcNo, 0, 3))))) {
        		$uBody.setsNpSettProvider($uBody.getsSettlCarrier());
        		$uBody.setsNpSettFeature($uBody.getsSettlFeatureCd());
       
        		TbNoMovBizrBasInfo tbNoMovBizrBas = audit.get_TB_NO_MOV_BIZR_BAS($uBody.getsNpOperator(), $uBody.getsCallStartDateTime(), $uBody.getsSpIndi(), "ORG", $uBody.getsChrgOtherNo());
       
        		if (tbNoMovBizrBas != null ) {
         			$uBody.setsSettlFileName(tbNoMovBizrBas.getsSettlFileName());
         			$uBody.setsSettlCarrier(tbNoMovBizrBas.getsNpSettlCarrier());
         			$uBody.setsSettlFeatureCd(tbNoMovBizrBas.getsSettlFeatureCd());
         			$uBody.setsInNetCallYn(tbNoMovBizrBas.getsInNetCallYn());
        		}
       		}
      	}
      	
     
     	// if ((uBody.sSpIndi == "Y") && (uBody.sNpInd == "Y") &&
		// !uBody.bIsINTERNATIONAL && (uBody.bIsVISUAL_CALL)) {
     	// uBody.sNpSettProvider = uBody.sSettlCarrier;
     	// uBody.sNpSettFeature = uBody.sSettlFeatureCd;

     	// TB_NO_MOV_BIZR_BAS_Intl uTB_NO_MOV_BIZR_BAS =
		// getTB_NO_MOV_BIZR_BAS(uBody.sNpOperator,
		// enriched.getsCallStartDateTime(), uBody.sSpIndi, "OTR",
		// uBody.sChrgOtherNo);

     	// if (uTB_NO_MOV_BIZR_BAS.lRowCnt > 0) {
     	// uBody.sSettlFileName = uTB_NO_MOV_BIZR_BAS.sSettlFileName;
		// //WORK.sett_fname
     	// uBody.sSettlCarrier = uTB_NO_MOV_BIZR_BAS.sNpSettlCarrier;
		// //WORK.sett_provider
     	// uBody.sSettlFeatureCd = uTB_NO_MOV_BIZR_BAS.sSettlFeatureCd;
		// //WORK.sett_feature
     	// uBody.sInNetCallYn = uTB_NO_MOV_BIZR_BAS.sInNetCallYn;
		// //WORK.in_network_ind
     	// }
     	// TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_5 =
		// get_TB_WLESS_SPCL_NO_BAS(uBody.sCalledArea, uBody.sChrgOtherNo,
		// "KTF", enriched.getsCallStartDateTime(), SPNM);
         
     	// if (uTB_WLESS_SPCL_NO_BAS_5.lRowCnt > 0) {
     	// uBody.sSettlFeatureCd = uTB_WLESS_SPCL_NO_BAS_5.sSettlFeatureType;
     	// }

     	// }
      	if (($uBody.getsSpIndi().equals("Y")) && ($uBody.getsNpInd().equals("Y")) && !$uBody.isbIsINTERNATIONAL() && $uBody.isbIsVISUAL_CALL()) {
       		 $uBody.setsNpSettProvider($uBody.getsSettlCarrier());
       		 $uBody.setsNpSettFeature($uBody.getsSettlFeatureCd());
       
       		TbNoMovBizrBasInfo tbNoMovBizrBas = audit.get_TB_NO_MOV_BIZR_BAS($uBody.getsNpOperator(), $uBody.getsCallStartDateTime(), $uBody.getsSpIndi(), "ORG", $uBody.getsChrgOtherNo());
       
       		if (tbNoMovBizrBas != null ) {
        		$uBody.setsSettlFileName(tbNoMovBizrBas.getsSettlFileName());
        		$uBody.setsSettlCarrier(tbNoMovBizrBas.getsNpSettlCarrier());
        		$uBody.setsSettlFeatureCd(tbNoMovBizrBas.getsSettlFeatureCd());
        		$uBody.setsInNetCallYn(tbNoMovBizrBas.getsInNetCallYn());
       		}
      	}

		// RBMS_20150726201256.xml
     
     	// if (($uBody.sSpIndi == "Y") && ($uBody.sNpInd == "Y") &&
		// !$uBody.bIsINTERNATIONAL && ($uBody.bIsVISUAL_CALL)) {
     	// if (!($uBody.sCalledSvcNo == null || $uBody.sCalledSvcNo == "") &&
		// (!(listFindIndex(LST_MOBILE_PREFIX, i, i ==
		// comnSubstring($uBody.sCalledSvcNo, 0, 3)) > -1))) {
     	// $uBody.sNpSettProvider = $uBody.sSettlCarrier;
     	// $uBody.sNpSettFeature = $uBody.sSettlFeatureCd;

     	// TB_NO_MOV_BIZR_BAS_Intl uTB_NO_MOV_BIZR_BAS =
		// getTB_NO_MOV_BIZR_BAS($uBody.sNpOperator,
		// enriched.getsCallStartDateTime(), $uBody.sSpIndi, "OTR",
		// $uBody.sChrgOtherNo);

     	// if (uTB_NO_MOV_BIZR_BAS.lRowCnt > 0) {
     	// $uBody.sSettlFileName = uTB_NO_MOV_BIZR_BAS.sSettlFileName;
		// //WORK.sett_fname
     	// $uBody.sSettlCarrier = uTB_NO_MOV_BIZR_BAS.sNpSettlCarrier;
		// //WORK.sett_provider
     	// $uBody.sSettlFeatureCd = uTB_NO_MOV_BIZR_BAS.sSettlFeatureCd;
		// //WORK.sett_feature
     	// $uBody.sInNetCallYn = uTB_NO_MOV_BIZR_BAS.sInNetCallYn;
		// //WORK.in_network_ind
     	// }
     	// }
     	// }
      	if (($uBody.getsSpIndi().equals("Y")) && ($uBody.getsNpInd().equals("Y")) && !$uBody.isbIsINTERNATIONAL() && $uBody.isbIsVISUAL_CALL()) {
       		if (!($uBody.getsCalledSvcNo() == null || $uBody.getsCalledSvcNo().equals("")) && (!($uBody.getLST_MOBILE_PREFIX().contains(CommonUtils.comnSubstring($uBody.getsCalledSvcNo(),0,3))))) {
        		$uBody.setsNpSettProvider($uBody.getsSettlCarrier());
        		$uBody.setsNpSettFeature($uBody.getsSettlFeatureCd());
       
        		TbNoMovBizrBasInfo tbNoMovBizrBas = audit.get_TB_NO_MOV_BIZR_BAS($uBody.getsNpOperator(), $uBody.getsCallStartDateTime(), $uBody.getsSpIndi(), "ORG", $uBody.getsChrgOtherNo());
       
        		if (tbNoMovBizrBas != null ) {
         			$uBody.setsSettlFileName(tbNoMovBizrBas.getsSettlFileName());
         			$uBody.setsSettlCarrier(tbNoMovBizrBas.getsNpSettlCarrier());
         			$uBody.setsSettlFeatureCd(tbNoMovBizrBas.getsSettlFeatureCd());
         			$uBody.setsInNetCallYn(tbNoMovBizrBas.getsInNetCallYn());
        		}
       		}
      	}

     	// Rule : special_number_kt114
     	// if ($uBody.sSpIndi == "Y") {
     
     	// TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_6 =
		// get_TB_WLESS_SPCL_NO_BAS($uBody.sCalledArea, $uBody.sChrgOtherNo,
		// "KTF", enriched.getsCallStartDateTime(), SPNM);
         
     	// if (uTB_WLESS_SPCL_NO_BAS_6.lRowCnt > 0) {
     	// $uBody.sProdCd = uTB_WLESS_SPCL_NO_BAS_6.sFeatureCd;
     	// }
     	// }
     
     	if ($uBody.getsSpIndi().equals("Y")) {
      
      		WlessSpclNoBasInfo tbWlessSpclNoBas6 = audit.get_TB_WLESS_SPCL_NO_BAS($uBody.getsCalledArea(), $uBody.getsChrgOtherNo(), "KTF", $uBody.getsCallStartDateTime(), $uBody.getSpnm());
   
   			if (tbWlessSpclNoBas6 != null )
    			$uBody.setsProdCd(tbWlessSpclNoBas6.getsFeatureCd());
  		}
     	// Rule : tb_calling_numbers_dom
     	// if ($uBody.sTermCode == CDF_NORM_V) {
     	// TB_CAL_NO_BAS_Intl uTB_CAL_NO_BAS =
		// get_TB_CAL_NO_BAS(strSubstring($uBody.sChrgSvcNo, 0, 3),
		// strSubstring($uBody.sChrgSvcNo, 3, 7), strSubstring($uBody.sChrgSvcNo,
		// 7, 11), enriched.getsCallStartDateTime());
         
     	// if (uTB_CAL_NO_BAS.lRowCnt > 0) {
     	// $uBody.sCallingDropIndi = "Y";
     	// }
     	// }
     
     	if ($uBody.getsTermCode().equals($uBody.getCdfNormV())) {
      		TbCalNoBasInfo tbCalNoBas = audit.get_TB_CAL_NO_BAS($uBody.getsChrgSvcNo().substring(0, 3), $uBody.getsChrgSvcNo().substring(3, 7), $uBody.getsChrgSvcNo().substring(7, 11), $uBody.getsCallStartDateTime());
      
      		if (tbCalNoBas != null )
       			$uBody.setsCallingDropIndi("Y");
  		}
   
     	// Rule : tb_maf_features_dom1
     	// if ($uBody.sTermCode == CDF_NORM_V) {

     	// if ($uBody.sProdFromatId != null && $uBody.sProdCdType != null &&
		// $uBody.sSscode != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, $uBody.sProdCdType,
		// $uBody.sSscode, enriched.getsCallStartDateTime());
     	// if (uTB_FEATR_BAS.lRowCnt > 0) {
     	// $uBody.sProdCdIndi = "Y";
     	// $uBody.sProdDropCall = "Y";
     	// }
     	// }
     	// }
      	if ($uBody.getsTermCode().equals($uBody.getCdfNormV())) {
       		if ( !( $uBody.getsProdFormatId() == null || $uBody.getsProdFormatId().equals("") ) && !( $uBody.getsProdCdType() == null || $uBody.getsProdCdType().equals("") ) && !( $uBody.getsSscode() == null || $uBody.getsSscode().equals("") )) {
 
       			TbFeatrBasInfo tbFeatrBas = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), $uBody.getsProdCdType(), $uBody.getsSscode(), $uBody.getsCallStartDateTime());
       			if (tbFeatrBas != null ) {
       				$uBody.setsProdCdIndi("Y");
       				$uBody.setsProdDropCall("Y");
       			}
   			}
   		}
   
     
     	// boolean bExistFeatures;
     	// if ($uBody.sProdFromatId != null && $uBody.sProdCdType != null &&
		// $uBody.sSscode != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, $uBody.sProdCdType,
		// $uBody.sSscode,sCallStartDateTime);
     	// if (uTB_FEATR_BAS.lRowCnt > 0) {
     	// bExistFeatures = true;
     	// }
     	// }
      	boolean bExistFeatures = false;
      	
      	if ( !( $uBody.getsProdFormatId() == null || $uBody.getsProdFormatId().equals("") ) && !( $uBody.getsProdCdType() == null || $uBody.getsProdCdType().equals("") ) && !( $uBody.getsSscode() == null || $uBody.getsSscode().equals("") )) {
     
       		TbFeatrBasInfo tbFeatrBas = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), $uBody.getsProdCdType(), $uBody.getsSscode(), $uBody.getsCallStartDateTime());
       
       		if (tbFeatrBas != null )
        		bExistFeatures = true;
      	}
      

     	// if (($uBody.sTermCode == CDF_NORM_V) && !($uBody.sSscode == "" ||
		// $uBody.sSscode == null) &&
     	// !(listFindIndex(LST_SSCODE_VMS, i, i == $uBody.sSscode) > -1) &&
     	// !($uBody.sSscode == SSCODE_GC && $uBody.bIsVOLTE_4G_CALL) &&
		// !($uBody.sSscode == SSCODE_TWONUMBER) &&
     	// !($uBody.sSscode == SSCODE_FREE_ZONE && ($uBody.bIsVOLTE_4G_CALL ||
		// $uBody.bIsPSVT_3G_CALL || $uBody.bIsPSVT_4G_CALL )) &&
		// !$uBody.bIsEMS_CALLED && !bExistFeatures) {

     	// $uBody.sProdCdIndi = "E";
     	// }
      	if (($uBody.getsTermCode().equals($uBody.getCdfNormV())) && !($uBody.getsSscode().equals("") || $uBody.getsSscode() == null) &&
       		!($uBody.getLST_SSCODE_VMS().contains($uBody.getsSscode())) &&
       		!($uBody.getsSscode().equals($uBody.getSscodeGc()) && $uBody.isbIsVOLTE_4G_CALL()) && 
       		!($uBody.getsSscode().equals($uBody.getSscodeTwonumber())) &&
       		!($uBody.getsSscode().equals($uBody.getSscodeFreeZone())) && 
       		($uBody.isbIsVOLTE_4G_CALL() || $uBody.isbIsPSVT_3G_CALL() || $uBody.isbIsPSVT_4G_CALL()) &&
       		!$uBody.isbIsEMS_CALLED() && !bExistFeatures)
       		$uBody.setsProdCdIndi("E");
       
     	// Rule : tb_special_numbers_indicator
     	// if ($uBody.sSpIndi == "Y") {
      
     	// TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_7 =
		// get_TB_WLESS_SPCL_NO_BAS($uBody.sCalledArea, $uBody.sChrgOtherNo,
		// "KTF", enriched.getsCallStartDateTime(), $uBody.sSpNumberType);;
     	// if (uTB_WLESS_SPCL_NO_BAS_7.lRowCnt > 0) {
     	// $uBody.sSpnAcInd = uTB_WLESS_SPCL_NO_BAS_7.sAirtimeChrgYn; //
		// WORK.spn_ac_ind
     	// $uBody.sSpNoAtIndi = uTB_WLESS_SPCL_NO_BAS_7.sAirtimeIndi; //
		// WORK.spn_at_ind
     	// $uBody.sSpnSpInd = uTB_WLESS_SPCL_NO_BAS_7.sIspYn; // WORK.spn_sp_ind
     	// $uBody.sSpnDpClInd = uTB_WLESS_SPCL_NO_BAS_7.sFeatureDropIndi; //
		// WORK.spn_dp_cl_ind
     	// $uBody.sSpnPpsDpClInd = uTB_WLESS_SPCL_NO_BAS_7.sPpsDropIndi; //
		// WORK.spn_pps_dp_cl_ind
     	// $uBody.sSpnAtFtrInd = uTB_WLESS_SPCL_NO_BAS_7.sAirtimeFuncYn; //
		// WORK.spn_at_ftr_ind
     	// $uBody.sSpnSpNmTp = uTB_WLESS_SPCL_NO_BAS_7.sSpecialNoType; //
		// WORK.spn_sp_nm_tp
     	// }
     	// }
      	if ($uBody.getsSpIndi().equals("Y")) {
       		WlessSpclNoBasInfo tbWlessSpclNoBas7 = audit.get_TB_WLESS_SPCL_NO_BAS($uBody.getsCalledArea(), $uBody.getsChrgOtherNo(), "KTF", $uBody.getsCallStartDateTime(), $uBody.getsSpNumberType());
       
       		if (tbWlessSpclNoBas7 != null ) {
        		$uBody.setsSpnAcInd(tbWlessSpclNoBas7.getsAirtimeChrgYn());
        		$uBody.setsSpNoAtIndi(tbWlessSpclNoBas7.getsAirtimeIndi());
        		$uBody.setsSpnSpInd(tbWlessSpclNoBas7.getsIspYn());
        		$uBody.setsSpnDpClInd(tbWlessSpclNoBas7.getsFeatureDropIndi());
        		$uBody.setsSpnPpsDpClInd(tbWlessSpclNoBas7.getsPpsDropIndi());
        		$uBody.setsSpnAtFtrInd(tbWlessSpclNoBas7.getsAirtimeFuncYn());
        		$uBody.setsSpnSpNmTp(tbWlessSpclNoBas7.getsSpecialNoType());
       		}
      	}
      

     	// Rule : tb_special_numbers_settinfo_vc
     	// if (($uBody.sSpIndi == "Y") && ($uBody.bIsVOICE_CALL)) {
     
     	// TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_8 =
		// get_TB_WLESS_SPCL_NO_BAS($uBody.sCalledArea, $uBody.sChrgOtherNo,
		// "KTF", enriched.getsCallStartDateTime(), SPNM);
         
     	// if (uTB_WLESS_SPCL_NO_BAS_8.lRowCnt > 0) {
     	// $uBody.sSettlFileName = uTB_WLESS_SPCL_NO_BAS_8.sSettlFileName;
     	// $uBody.sSettlFeatureCd = uTB_WLESS_SPCL_NO_BAS_8.sSettlFeatureCd; //
		// ORG �� ���
     	// $uBody.sSettlCarrier = uTB_WLESS_SPCL_NO_BAS_8.sSettlCarrier;
     	// $uBody.sIntlNxx = uTB_WLESS_SPCL_NO_BAS_8.sNxxNo;
     	// }
     	// }
     
      	if ($uBody.getsSpIndi().equals("Y") && $uBody.isbIsVOICE_CALL()) {
       		WlessSpclNoBasInfo tbWlessSpclNoBas8 = audit.get_TB_WLESS_SPCL_NO_BAS($uBody.getsCalledArea(), $uBody.getsChrgOtherNo(), "KTF", $uBody.getsCallStartDateTime(), $uBody.getSpnm());
       
       		if (tbWlessSpclNoBas8 != null ) {
        		$uBody.setsSettlFileName(tbWlessSpclNoBas8.getsSettlFileName());
        		$uBody.setsSettlFeatureCd(tbWlessSpclNoBas8.getsSettlFeatureCd());
        		$uBody.setsSettlCarrier(tbWlessSpclNoBas8.getsSettlCarrier());
        		$uBody.setsIntlNxx(tbWlessSpclNoBas8.getsIntlNxx());
       		}
      	}     
        
     	// Rule : tb_special_numbers_settinfo_vs
     	// if (($uBody.sSpIndi == "Y") && ($uBody.bIsVISUAL_CALL)) {
     
     	// TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_9 =
		// get_TB_WLESS_SPCL_NO_BAS($uBody.sCalledArea, $uBody.sChrgOtherNo,
		// "KTF", enriched.getsCallStartDateTime(), SPNM);
         
     	// if (uTB_WLESS_SPCL_NO_BAS_9.lRowCnt > 0) {
     	// $uBody.sSettlFileName = uTB_WLESS_SPCL_NO_BAS_9.sSettlFileName;
     	// $uBody.sSettlFeatureCd = uTB_WLESS_SPCL_NO_BAS_9.sSettlFeatureType; //
		// OTR �� ���
     	// $uBody.sSettlCarrier = uTB_WLESS_SPCL_NO_BAS_9.sSettlCarrier;
     	// $uBody.sIntlNxx = uTB_WLESS_SPCL_NO_BAS_9.sNxxNo;
     	// }
     	// }
      	if ($uBody.getsSpIndi().equals("Y") && $uBody.isbIsVISUAL_CALL()) {
       		WlessSpclNoBasInfo tbWlessSpclNoBas9 = audit.get_TB_WLESS_SPCL_NO_BAS($uBody.getsCalledArea(), $uBody.getsChrgOtherNo(), "KTF", $uBody.getsCallStartDateTime(), $uBody.getSpnm());
       
       		if (tbWlessSpclNoBas9 != null ) {
        		$uBody.setsSettlFileName(tbWlessSpclNoBas9.getsSettlFileName());
        		$uBody.setsSettlFeatureCd(tbWlessSpclNoBas9.getsSettlFeatureCd());
        		$uBody.setsSettlCarrier(tbWlessSpclNoBas9.getsSettlCarrier());
        		$uBody.setsIntlNxx(tbWlessSpclNoBas9.getsIntlNxx());
       		}
      	}
		
     	// Rule : tb_special_numbers_zzz
     	// if ($uBody.sSpIndi == "Y") {
     	// if ($uBody.sSpnSpNmTp == "S") {
     	// $uBody.sCalledPatryPayCall = "Y";
     	// $uBody.sChrgSvcNo = wlssEditTelNo($uBody.sCalledSvcNo, 11);
     	// }
     	// }
     	if ($uBody.getsSpIndi().equals("Y")) {
      		if ($uBody.getsSpnSpNmTp().equals("S")) {
       			$uBody.setsCalledPartyPayCall("Y");
       			$uBody.setsChrgSvcNo($uBody.getsCalledSvcNo());
      		}
     	}

   		// Rule : add_ftr_wstype
     	// if ($uBody.sProdFromatId != null && $uBody.sInsProdType != null &&
		// $uBody.sWinSvcType != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, $uBody.sInsProdType,
		// $uBody.sWinSvcType, sCallStartDateTime);
  		//
     	// if (uTB_FEATR_BAS.lRowCnt > 0) {
     	// $uBody.sFeatureDropIndi = uTB_FEATR_BAS.sFeatureDropIndi; //
		// chk_wstype Validation ���� ����ϱ� ���� �߰�.
     	// $uBody.bIsWSTYPE_RANGE = true; // win_chk_service_not_found Validation
		// ���� ����ϱ� ���� �߰�.
  		//
     	// if (!(uTB_FEATR_BAS.sFeatureDropIndi == "Y")) {
     	// string sFeatureAdd = uTB_FEATR_BAS.sFeatureCd;
     	// if (!(sFeatureAdd == "ZZZZZZ")) {
     	// $uBody.sMpsFeatureCd = comnPadChr(sFeatureAdd, 6, " ", "R");
     	// }
     	// }
     	// }
     	// }
      	if ( !( $uBody.getsProdFormatId() == null || $uBody.getsProdFormatId().equals("") ) && !( $uBody.getsInsProdType() == null || $uBody.getsInsProdType().equals("") ) && !( $uBody.getsWinSvcType() == null || $uBody.getsWinSvcType().equals("") )) {
       		TbFeatrBasInfo tbFeatrBas = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), $uBody.getsInsProdType(), $uBody.getsWinSvcType(), $uBody.getsCallStartDateTime());
       
       		if (tbFeatrBas != null ) {
        		$uBody.setsFeatureDropIndi(tbFeatrBas.getsFeatureDropIndi());
        		$uBody.setbIsWSTYPE_RANGE(true);
        
        		if (!tbFeatrBas.getsFeatureDropIndi().equals("Y")) {
         			String sFeatureAdd = tbFeatrBas.getsFeatureCd();
         
         			if (!(sFeatureAdd.equals("ZZZZZZ"))) {
          				$uBody.setsMpsFeatureCd(comnPadChr(sFeatureAdd, 6, " ", "R"));
         			}
        		}
       		}
      	}      
      
     	// if ($uBody.bIsTIME_CDR || $uBody.bIsTIME_CDR_001) {
     	// $uBody.iDurSecPrepaid = $uBody.service_prepaid_airtime_charge +
		// $uBody.service_prepaid_information_charge;
     	// } else if ($uBody.bIsOCR_CDR || $uBody.bIsOCR_CDR_001) {
     	// $uBody.iDurSecPrepaid = 1;
     	// }
     	if ($uBody.isbIsTIME_CDR() || $uBody.isbIsTIME_CDR_001()) {
    		$uBody.setiDurSecPrepaid(Integer.parseInt($uBody.getService_prepaid_airtime_charge().equals("") ? "0" : $uBody.getService_prepaid_airtime_charge()) + Integer.parseInt($uBody.getService_prepaid_information_charge().equals("") ? "0" : $uBody.getService_prepaid_information_charge()));
     	} else if ($uBody.isbIsOCR_CDR() || $uBody.isbIsOCR_CDR_001()) {
      		$uBody.setiDurSecPrepaid(1);
     	} 
      
     	// if ($uBody.sCalledPatryPayCall == "Y") {
     	// $uBody.bIsCALLED_PARTY_PAY_CALL = true;
     	// }
     	// else {
     	// $uBody.bIsCALLED_PARTY_PAY_CALL = false;
     	// }
     	if ($uBody.getsCalledPartyPayCall().equals("Y")) {
      		$uBody.setbIsCALLED_PARTY_PAY_CALL(true);
     	} else {
      		$uBody.setbIsCALLED_PARTY_PAY_CALL(false);
     	}

     	// Rule : call_to_tn_cal_prt_pay
     	// if ($uBody.bIsCALLED_PARTY_PAY_CALL) {
     	// $uBody.sWorkCalledSvcNo = $uBody.sCallingSvcNo;
     	// }
     	if ($uBody.isbIsCALLED_PARTY_PAY_CALL()) {
      		$uBody.setsWorkCalledSvcNo($uBody.getsCallingSvcNo());
     	}

  
     	// if ($uBody.bIsINTERNATIONAL && !$uBody.bIsINTL_SERVICE_PROVIDER) {
     	// if ($uBody.sSettlFileName == "INN") {
     	// $uBody.sWorkCalledSvcNo = comnSubstring($uBody.sCalledSvcNo,5,17);
     	// } else {
     	// $uBody.sWorkCalledSvcNo = comnSubstring($uBody.sCalledSvcNo,3,18);
     	// }
     	// }
     	if ($uBody.isbIsINTERNATIONAL() && !$uBody.isbIsINTL_SERVICE_PROVIDER()) {
      		if ($uBody.getsSettlFileName().equals("INN")) {
       			$uBody.setsWorkCalledSvcNo(CommonUtils.comnSubstring($uBody.getsCalledSvcNo(), 5, 17));
      		} else {
       			$uBody.setsWorkCalledSvcNo(CommonUtils.comnSubstring($uBody.getsCalledSvcNo(), 3, 18));
      		}
     	}
     
		// RBMS_20150726201256.xml
     
     	// if (!$uBody.bIsINTERNATIONAL && !$uBody.bIsCALLED_PARTY_PAY_CALL) {
     	// $uBody.sWorkCalledSvcNo = comnSubstring($uBody.sCalledSvcNo, 0, 14);
     	// }
     	if (!$uBody.isbIsINTERNATIONAL() && !$uBody.isbIsCALLED_PARTY_PAY_CALL()) {
      		$uBody.setsWorkCalledSvcNo(CommonUtils.comnSubstring($uBody.getsCalledSvcNo(), 0, 14));
     	}

     
     	// if ($uBody.bIsINTERNATIONAL && ($uBody.sSpIndi == "N") && (
		// !($uBody.sCalledArea == null || $uBody.sCalledArea.equals("") ) &&
		// $uBody.sCalledArea != "")){
     	// TB_INTL_PFIX_BAS_Intl uTB_INTL_PFIX_BAS =
		// get_TB_INTL_PFIX_BAS($uBody.sChrgOtherNo);
     	// if ( uTB_INTL_PFIX_BAS.lRowCnt > 0 ) {
     	// $uBody.sNationCd = uTB_INTL_PFIX_BAS.sIntlPrefixCd; // country_code
     	// $uBody.sSecondNationCd = uTB_INTL_PFIX_BAS.sSubIntlPrefixCd; //
		// fic_country_code
     	// }
     	// }

     	if ($uBody.isbIsINTERNATIONAL() && $uBody.getsSpIndi().equals("N") && $uBody.getsCalledArea() != null && !$uBody.getsCalledArea().equals("")) {
      
      		IntlPfixBasInfo tbIntlPfixBas = audit.get_TB_INTL_PFIX_BAS($uBody.getsChrgOtherNo());
      
      		if (tbIntlPfixBas != null ) {
       			$uBody.setsNationCd(tbIntlPfixBas.getsIntlPrefixCd());
       			$uBody.setsSecondNationCd(tbIntlPfixBas.getsSubIntlPrefixCd());
      		}
     	}
    	
     	// Rule : customer_call_feature
     	// if ( (comnStrLength($uBody.sChrgOtherNo) == 3 && $uBody.sChrgOtherNo ==
		// "100" ) || ((comnStrTrim($uBody.sChrgOtherNo) == "") &&
		// comnSubstring($uBody.sCalledArea,1,4) == "100")) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS_1 =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, "100", "", sCallStartDateTime);

     	// if (uTB_FEATR_BAS_1.lRowCnt > 0) {
     	// $uBody.sMpsFeatureCd = comnPadChr(uTB_FEATR_BAS_1.sFeatureCd, 6, " ",
		// "R");
     	// }
     	// }
     	if ($uBody.getsChrgOtherNo().length() == 3 && $uBody.getsChrgOtherNo().equals("100") || 
        	($uBody.getsChrgOtherNo().trim().equals("") && CommonUtils.comnSubstring($uBody.getsCalledArea(), 1,4).equals("100"))) {
        
         	TbFeatrBasInfo tbFeatrBas1 = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), "100", "", $uBody.getsCallStartDateTime());
        
         	if (tbFeatrBas1 != null ) {
          		$uBody.setsMpsFeatureCd(comnPadChr(tbFeatrBas1.getsFeatureCd(), 6, " ", "R"));
         	}
     	}
         
     
     	// if ($uBody.sProdFromatId != null && $uBody.sSecondNationCd != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS_1 =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, "100", $uBody.sSecondNationCd,
		// sCallStartDateTime);

     	// if (uTB_FEATR_BAS_1.lRowCnt > 0) {
     	// $uBody.bIsSAME_5COUNTRY = true;
     	// }

     	// if ($uBody.bIsSAME_5COUNTRY && !($uBody.bIsPPS_CALL ||
		// $uBody.bIsDADAN_CALL)) {
     	// $uBody.sMpsFeatureCd = comnPadChr(uTB_FEATR_BAS_1.sFeatureCd, 6, " ",
		// "R");
     	// }
     	// }
   		if ( !($uBody.getsProdFormatId() == null || $uBody.getsProdFormatId().equals("") ) && !( $uBody.getsSecondNationCd() == null || $uBody.getsSecondNationCd().equals("") )) {
    		TbFeatrBasInfo tbFeatrBas1 = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), "100", $uBody.getsSecondNationCd(), $uBody.getsCallStartDateTime());
    
    		if (tbFeatrBas1 != null ) {
     			$uBody.setbIsSAME_5COUNTRY(true);
    		}
    
    		if ($uBody.isbIsSAME_5COUNTRY() && !($uBody.isbIsPPS_CALL() || $uBody.isbIsDADAN_CALL())) {
     			$uBody.setsMpsFeatureCd(comnPadChr(tbFeatrBas1.getsFeatureCd(), 6, " ", "R"));
    		}
   		}

     
     	// if (($uBody.sCalledSvcNo != null &&
		// strstartsWith($uBody.sCalledSvcNo,"001")) && !$uBody.bIsSAME_5COUNTRY
		// && !($uBody.bIsPPS_CALL || $uBody.bIsDADAN_CALL)) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS_2 =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, "001", "", sCallStartDateTime);
     	// if (uTB_FEATR_BAS_2.lRowCnt > 0) {
     	// $uBody.sMpsFeatureCd = comnPadChr(uTB_FEATR_BAS_2.sFeatureCd, 6, " ",
		// "R");
     	// }
     	// }
      	if ((!( $uBody.getsCalledSvcNo() == null || $uBody.getsCalledSvcNo().equals("") ) && $uBody.getsCalledSvcNo().startsWith("001")) && !$uBody.isbIsSAME_5COUNTRY() && !($uBody.isbIsPPS_CALL() || $uBody.isbIsDADAN_CALL())) {
       		tbFeatrBas2 = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), "100", "", $uBody.getsCallStartDateTime());
       
       		if (tbFeatrBas2 != null ) {
        		$uBody.setsMpsFeatureCd(comnPadChr(tbFeatrBas2.getsFeatureCd(), 6, " ", "R"));
       		}
      	}

     
     	// if ($uBody.bIsIM_3G || $uBody.bIsIM_4G) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS_3 =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, "IM",
		// $uBody.service_category_id, sCallStartDateTime);

     	// if (uTB_FEATR_BAS_3.lRowCnt > 0) {
     	// $uBody.sMpsFeatureCd = comnPadChr(uTB_FEATR_BAS_3.sFeatureCd, 6, " ",
		// "R");
     	// }
     	// }
     
      	if ($uBody.isbIsIM_3G() || $uBody.isbIsIM_4G()) {
       		tbFeatrBas3 = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), "IM", $uBody.getService_category_id(), $uBody.getsCallStartDateTime());

    		if (tbFeatrBas3 != null ) {
     			$uBody.setsMpsFeatureCd(comnPadChr(tbFeatrBas3.getsFeatureCd(), 6, " ", "R"));
    		}
   		}
     	// if (($uBody.sTermCode == CDF_NORM_V) && ($uBody.sSscode ==
		// SSCODE_MPBX_FREE) && $uBody.bIsVOLTE_4G_CALL) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VCMPBX";
     	// }
     
      	if (($uBody.getsTermCode().equals($uBody.getCdfNormV())) && ($uBody.getsSscode().equals($uBody.getSscodeMpbxFree()) && $uBody.isbIsVOLTE_4G_CALL())) {
       		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VCMPBX");
      	}

		// feature_add_volte_3g_hd,
     	// feature_add_volte_4g_hd, feature_add_volte_hd,
		// feature_add_volte_not_hd
     	// if (listFindIndex(LST_SSCODE_MPBX, i, i == $uBody.sSscode) > -1) {
     	// $uBody.bIsSSCODE_MPBX = true;
     	// }
      	if ($uBody.getLST_SSCODE_MPBX().contains($uBody.getsSscode())) {
       		$uBody.setbIsSSCODE_MPBX(true);
      	}
      

     	// Rule : feature_add_psvt_3g
     	// -- VOLTE.PSVT_3G_CALL AND (WORK.sscode is SPACE or WORK.sscode is
		// VOLTE.SSCODE_TWONUMBER OR VOLTE.EMS_CALLED OR VOLTE.SSCODE_MPBX) AND
		// NOT(VOLTE.FPS_CALL)
     	// if ($uBody.bIsPSVT_3G_CALL && (comnStrTrim($uBody.sSscode) == "" ||
		// $uBody.sSscode == SSCODE_TWONUMBER || $uBody.bIsEMS_CALLED ||
		// $uBody.bIsSSCODE_MPBX) && !$uBody.bIsFPS_CALL) {
     	// if (($uBody.hd_call == "1") && ($uBody.sInNetCallYn == "Y")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVL2LK";
     	// }
     	// else if (($uBody.hd_call == "1") && ($uBody.sInNetCallYn == "N") &&
     	// (comnSubstring($uBody.terminating_inter_operator_identifier,0,8) !=
		// "octave.c")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVL2LO";
     	// }
     	// else if (($uBody.hd_call == "1") && ($uBody.sInNetCallYn == "N") &&
     	// (comnSubstring($uBody.terminating_inter_operator_identifier,0,8) ==
		// "octave.c")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVW2OT";
     	// }
     	// else if (($uBody.hd_call == "0") && ($uBody.sInNetCallYn == "Y")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVW2KT";
     	// }
     	// else if (($uBody.hd_call == "0") && ($uBody.sInNetCallYn == "N")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVW2OT";
     	// }
     	// }
      	if ($uBody.isbIsPSVT_3G_CALL() && ($uBody.getsSscode().trim().equals("") || $uBody.getsSscode().equals($uBody.getSscodeTwonumber()) || $uBody.isbIsEMS_CALLED() || $uBody.isbIsSSCODE_MPBX()) && !$uBody.isbIsFPS_CALL()) {
       		if ($uBody.getHd_call().equals("1") && $uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVL2LK");
       		} else if ($uBody.getHd_call().equals("1") && $uBody.getsInNetCallYn().equals("N") && 
           		(!CommonUtils.comnSubstring($uBody.getTerminating_inter_operator_identifier(),0,8).equals("octave.c"))) {
        			$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVW2LO");
       		} else if ($uBody.getHd_call().equals("1") && $uBody.getsInNetCallYn().equals("Y") && 
           		(CommonUtils.comnSubstring($uBody.getTerminating_inter_operator_identifier(),0,8).equals("octave.c"))) {
        			$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVW2OT");
       		} else if ($uBody.getHd_call().equals("0") && $uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVW2KT");
       		} else if ($uBody.getHd_call().equals("0") && $uBody.getsInNetCallYn().equals("N")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVW2OT");
       		}
      	}

     	// Rule : feature_add_psvt_4g
		// VOLTE.SSCODE_TWONUMBER OR VOLTE.EMS_CALLED OR VOLTE.SSCODE_MPBX) AND
		// NOT(VOLTE.FPS_CALL)
     	// if ($uBody.bIsPSVT_4G_CALL && (comnStrTrim($uBody.sSscode) == "" ||
		// $uBody.sSscode == SSCODE_TWONUMBER || $uBody.bIsEMS_CALLED ||
		// $uBody.bIsSSCODE_MPBX ) && !$uBody.bIsFPS_CALL) {
     	// if (($uBody.hd_call == "1") && ($uBody.sInNetCallYn == "Y")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVL2LK";
     	// }
     	// else if (($uBody.hd_call == "1") && ($uBody.sInNetCallYn == "N") &&
     	// (comnSubstring($uBody.terminating_inter_operator_identifier,0,8) !=
		// "octave.c")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVL2LO";
     	// }
     	// else if (($uBody.hd_call == "1") && ($uBody.sInNetCallYn == "N") &&
     	// (comnSubstring($uBody.terminating_inter_operator_identifier,0,8) ==
		// "octave.c")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVL2OT";
     	// }
     	// else if (($uBody.hd_call == "0") && ($uBody.sInNetCallYn == "Y")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVL2KT";
     	// }
     	// else if (($uBody.hd_call == "0") && ($uBody.sInNetCallYn == "N")) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "PVL2OT";
     	// }
     	// }
      	if ($uBody.isbIsPSVT_4G_CALL() && ($uBody.getsSscode().trim().equals("") || $uBody.getsSscode().equals($uBody.getSscodeTwonumber()) || $uBody.isbIsEMS_CALLED() || $uBody.isbIsSSCODE_MPBX()) && !$uBody.isbIsFPS_CALL()) {
       		if ($uBody.getHd_call().equals("1") && $uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVL2LK");
       		} else if ($uBody.getHd_call().equals("1") && $uBody.getsInNetCallYn().equals("N") && 
           		(!CommonUtils.comnSubstring($uBody.getTerminating_inter_operator_identifier(), 0,8).equals("octave.c"))) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVL2LO");
       		} else if ($uBody.getHd_call().equals("1") && $uBody.getsInNetCallYn().equals("Y") && 
           		(CommonUtils.comnSubstring($uBody.getTerminating_inter_operator_identifier(), 0,8).equals("octave.c"))) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVL2OT");
       		} else if ($uBody.getHd_call().equals("0") && $uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVL2KT");
       		} else if ($uBody.getHd_call().equals("0") && $uBody.getsInNetCallYn().equals("N")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "PVL2OT");
       		}
      	}


   		// feature_add_volte_3g_hd
     
     	// if (($uBody.bIsHD_3G_VOICE) && (comnStrTrim($uBody.sSscode) == "" ||
		// $uBody.sSscode == SSCODE_TWONUMBER || $uBody.bIsEMS_CALLED ||
		// $uBody.bIsSSCODE_MPBX) && !($uBody.bIsFPS_CALL)) {
     	// if ($uBody.sInNetCallYn == "" || $uBody.sInNetCallYn == null) {
     	// $uBody.sInNetCallYn = "N";
     	// }
     	// if ($uBody.sInNetCallYn == "Y") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VLT2KT";
     	// } else if ($uBody.sInNetCallYn == "N") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VLT2OT";
     	// }
     	// }
     
      	if (($uBody.isbIsHD_3G_VOICE()) && ($uBody.getsSscode().trim().equals("") || $uBody.getsSscode().trim().equals($uBody.getSscodeTwonumber()) || $uBody.isbIsEMS_CALLED() || $uBody.isbIsSSCODE_MPBX()) && !($uBody.isbIsFPS_CALL())) {
       		if ($uBody.getsInNetCallYn().equals("") || $uBody.getsInNetCallYn() == null) {
        		$uBody.setsInNetCallYn("N");
       		}
       		if ($uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VLT2KT");
       		} else if ($uBody.getsInNetCallYn().equals("N")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VLT2OT");
       		}
      	}

     	// feature_add_volte_4g_hd
     	// if (($uBody.bIsHD_4G_VOICE) && (comnStrTrim($uBody.sSscode) == "" ||
		// $uBody.sSscode == SSCODE_TWONUMBER || $uBody.bIsEMS_CALLED ||
		// $uBody.bIsSSCODE_MPBX) && !($uBody.bIsFPS_CALL)) {
     	// if ($uBody.sInNetCallYn == "" || $uBody.sInNetCallYn == null) {
     	// $uBody.sInNetCallYn = "N";
     	// }
     	// if ($uBody.sInNetCallYn == "Y") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VLT2LK";
     	// } else if ($uBody.sInNetCallYn == "N") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VLT2LO";
     	// }
     	// }
   		if (($uBody.isbIsHD_4G_VOICE()) && ($uBody.getsSscode().equals("") || $uBody.getsSscode().equals($uBody.getSscodeTwonumber()) || $uBody.isbIsEMS_CALLED() || $uBody.isbIsSSCODE_MPBX()) && !($uBody.isbIsFPS_CALL())) {
    		if ($uBody.getsInNetCallYn().equals("") || $uBody.getsInNetCallYn() == null) {
        		$uBody.setsInNetCallYn("N");
       		}
       		if ($uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VLT2KT");
       		} else if ($uBody.getsInNetCallYn().equals("N")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VLT2OT");
       		}
   		}
   
     	// Rule : feature_add_volte_hd

     	// string sTIOI =
		// comnSubstring($uBody.terminating_inter_operator_identifier,0,8);
     	// if (sTIOI == "ims.kt.c" || sTIOI == "sktims.n" || sTIOI == "lte-lgup"
		// || sTIOI == "octave.c" || sTIOI == "cs.kt.co") {
     	// $uBody.bIsTIOI_LIST = true;
     	// }
      	String sTIOI = CommonUtils.comnSubstring($uBody.getTerminating_inter_operator_identifier(), 0, 8);
      	if (sTIOI.equals("ims.kt.c") || sTIOI.equals("sktims.n") || sTIOI.equals("lte-lgup") || sTIOI.equals("octave.c") || sTIOI.equals("cs.kt.co")) {
       		$uBody.setbIsTIOI_LIST(true);
      	}

     	// if (($uBody.bIsVOLTE_4G_CALL) && (comnStrTrim($uBody.sSscode) == "" ||
		// $uBody.sSscode == SSCODE_TWONUMBER || $uBody.bIsEMS_CALLED ||
		// $uBody.bIsSSCODE_MPBX) &&
     	// !($uBody.bIsFPS_CALL) && ($uBody.hd_call == "1") &&
		// !$uBody.bIsTIOI_LIST) {
     	// if ($uBody.sInNetCallYn == null || $uBody.sInNetCallYn == "") {
     	// $uBody.sInNetCallYn = "N";
     	// }
     	// if ($uBody.sInNetCallYn == "Y") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VLT2KT";
     	// } else if ($uBody.sInNetCallYn == "N") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VLT2OT";
     	// }
     	// }
      	if (($uBody.isbIsVOLTE_4G_CALL()) && ($uBody.getsSscode().equals("") || $uBody.getsSscode().equals($uBody.getSscodeTwonumber()) || $uBody.isbIsEMS_CALLED() || $uBody.isbIsSSCODE_MPBX()) && 
       		!($uBody.isbIsFPS_CALL()) && ($uBody.getHd_call().equals("1")) && !($uBody.isbIsTIOI_LIST())) {
       		if ($uBody.getsInNetCallYn().equals("") || $uBody.getsInNetCallYn() == null) {
        		$uBody.setsInNetCallYn("N");
       		}
       		if ($uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VLT2KT");
       		} else if ($uBody.getsInNetCallYn().equals("N")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VLT2OT");
       		}
      	}

     	// feature_add_volte_not_hd
     	// if (($uBody.bIsVOLTE_4G_CALL) && (comnStrTrim($uBody.sSscode) == "" ||
		// $uBody.sSscode == SSCODE_TWONUMBER || $uBody.bIsEMS_CALLED ||
		// $uBody.bIsSSCODE_MPBX) &&
     	// !($uBody.bIsFPS_CALL) && ($uBody.hd_call == "0")) {
     	// if ($uBody.sInNetCallYn == "" || $uBody.sInNetCallYn == null) {
     	// $uBody.sInNetCallYn = "N";
     	// }

     	// if ($uBody.sInNetCallYn == "Y") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VLT2KT";
     	// } else if ($uBody.sInNetCallYn == "N") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VLT2OT";
     	// }
     	// }
      	if (($uBody.isbIsVOLTE_4G_CALL()) && ($uBody.getsSscode().equals("") || $uBody.getsSscode().equals($uBody.getSscodeTwonumber()) || $uBody.isbIsEMS_CALLED() || $uBody.isbIsSSCODE_MPBX()) &&
       		!($uBody.isbIsFPS_CALL()) && ($uBody.getHd_call().equals("0"))) {
       		if ($uBody.getsInNetCallYn().equals("") || $uBody.getsInNetCallYn() == null) {
        		$uBody.setsInNetCallYn("N");
       		}
       		if ($uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VLT2KT");
       		} else if ($uBody.getsInNetCallYn().equals("N")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VLT2OT");
       		}
      	}

     	// Rule : feature_add_vs_3g
     	// if ($uBody.bIsVS_3G_CALL) {
     	// if ($uBody.sInNetCallYn == "Y") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "RVW2KT";
     	// }
     	// else if ($uBody.sInNetCallYn == "N") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "RVW2OT";
     	// }
     	// }
   		if ($uBody.isbIsVS_3G_CALL()) {
    		if ($uBody.getsInNetCallYn().equals("") || $uBody.getsInNetCallYn() == null) {
        		$uBody.setsInNetCallYn("N");
       		}
       		if ($uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "RVW2KT");
       		} else if ($uBody.getsInNetCallYn().equals("N")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "RVW2OT");
       		}
   		}
   		
     	// Rule : feature_add_vs_4g
     	// if ($uBody.bIsVS_4G_CALL) {
     	// if ($uBody.sInNetCallYn == "Y") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "RVL2KT";
     	// }
     	// else if ($uBody.sInNetCallYn == "N") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "RVL2OT";
     	// }
     	// }
      	if ($uBody.isbIsVS_4G_CALL()) {
    		if ($uBody.getsInNetCallYn().equals("") || $uBody.getsInNetCallYn() == null) {
        		$uBody.setsInNetCallYn("N");
       		}
       		if ($uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "RVL2KT");
       		} else if ($uBody.getsInNetCallYn().equals("N")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "RVL2OT");
       		}
   		}
   		
   		// KTF_CSUB : WORK.sett_provider[1,4] is ("KTF ","HSP ")
     	// sNpSettProvider
     	// if ((uBody.sSettlCarrier == "KTF") || (uBody.sSettlCarrier == "HSP"))
		// {
     	// uBody.bIsKTF_CSUB = true;
     	// }
      	if (($uBody.getsSettlCarrier().equals("KTF") || $uBody.getsSettlCarrier().equals("HSP"))) {
       		$uBody.setbIsKTF_CSUB(true);
      	}

     	// Rule : feature_fps_0
     	// if ($uBody.bIsNORMAL_COMP) {
     	// if (($uBody.sSettlFileName == "KTF") || ($uBody.bIsKTF_CSUB)) {
     	// if (($uBody.bIsFPS_CALL && $uBody.sFpsResult == "Y") &&
     	// (!(((listFindIndex(LST_SSCODE_VMS, i, i == $uBody.sSscode) > -1) &&
		// $uBody.sIpasResult == "Y") ||
     	// ($uBody.sVmsAccess == "00" && $uBody.sVmsResult == "Y")))) {

     	// $uBody.sMutualConnType = "0";
     	// if ($uBody.bIsVISUAL_CALL) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "FPVSKF";
     	// }
     	// else {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "FPVCKF";
     	// }
     	// }
     	// }
     	
     	// Rule : feature_fps_3
     	// if (!(($uBody.sSettlFileName == "INT" || $uBody.sSettlFileName ==
		// "INN") || $uBody.sSettlFileName == "KTF" || $uBody.bIsKTF_CSUB)) {
     	// if (($uBody.bIsFPS_CALL) && ($uBody.sFpsResult == "Y")) {
     	// $uBody.sMutualConnType = "3";
     	// $uBody.sInNetCallYn = "N";

     	// if ($uBody.bIsVISUAL_CALL) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "FPVSOT";
     	// }
     	// else {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "FPVCOT";
     	// }
     	// }
     	// }
     	// }
      	if ($uBody.isbIsNORMAL_COMP()) {
       		if (($uBody.getsSettlFileName().equals("KTF") || $uBody.isbIsKTF_CSUB())) {
        		if (($uBody.isbIsFPS_CALL() && $uBody.getsFpsResult().equals("Y") &&
         			(!(($uBody.getLST_SSCODE_VMS().contains($uBody.getsSscode())) && $uBody.getsIpasResult().equals("Y")) ||
         			($uBody.getsVmsAccess().equals("00") && $uBody.getsVmsResult().equals("Y"))))) {
         			$uBody.setsMutualConnType("0");
         
         			if ($uBody.isbIsVISUAL_CALL()) {
          				$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "FPVSKF");
         			} else {
          				$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "FPVCKF");
         			}
        		}
       		}
      
    		if (!(($uBody.getsSettlFileName().equals("INT") || $uBody.getsSettlFileName().equals("INN")) || $uBody.getsSettlFileName().equals("KTF") || $uBody.isbIsKTF_CSUB())) {
     			if (($uBody.isbIsFPS_CALL()) && ($uBody.getsFpsResult().equals("Y"))) {
      				$uBody.setsMutualConnType("3");
      				$uBody.setsInNetCallYn("Y");
      
      				if ($uBody.isbIsVISUAL_CALL()) {
       					$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "FPVSOT");
      				} else {
       					$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "FPVCOT");
     				}
     			}
    		}
   		}
     	// if ($uBody.bIsVOICE_CALL) {
     	// if ($uBody.sTermArea == "WR") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "KT2WIR";
     	// }
     	// }
      	if ($uBody.isbIsVOICE_CALL()) {
       		if ($uBody.getsTermArea().equals("WR")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "KT2WIR");
       		}
      	}

     	// Rule : interconnection_type
     	// if ($uBody.sInNetCallYn == "Y") {
     	// $uBody.sMutualConnType = "0";
     	// }
     	// else if ($uBody.sInNetCallYn == "N") {
     	// $uBody.sMutualConnType = "3";
     	// }
      	if ($uBody.getsInNetCallYn().equals("Y")) {
       		$uBody.setsMutualConnType("0");
      	} else if ($uBody.getsInNetCallYn().equals("N")) {
       		$uBody.setsMutualConnType("3");
      	}

     	// Rule : interconnection_type_0
     	// if (($uBody.bIsNORMAL_COMP) && (listFindIndex(LST_SSCODE_CF, i, i ==
		// $uBody.sSscode) > -1) &&
     	// (!($uBody.sSettlFileName == "INT" || $uBody.sSettlFileName == "INN"))
		// &&
     	// ($uBody.sSettlFileName == "KTF" || $uBody.bIsKTF_CSUB) &&
     	// (!($uBody.bIsFPS_CALL && $uBody.sFpsResult == "Y")) &&
     	// (!(((listFindIndex(LST_SSCODE_VMS, i, i == $uBody.sSscode) > -1) &&
		// ($uBody.sIpasResult == "Y")) ||
     	// ($uBody.sVmsAccess == "00" && $uBody.sVmsResult == "Y")))) {

     	// $uBody.sMutualConnType = "0";

     	// if ($uBody.bIsVISUAL_CALL) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VS2KTF";
     	// }
     	// else {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "KTF2KT";
     	// }
     	// }
      	if (($uBody.isbIsNORMAL_COMP()) && ($uBody.getLST_SSCODE_CF().contains($uBody.getsSscode())) &&
       		(!($uBody.getsSettlFileName().equals("INT") || $uBody.getsSettlFileName().equals("INN"))) &&
       		($uBody.getsSettlFileName().equals("KTF") || $uBody.isbIsKTF_CSUB()) &&
       		(!($uBody.isbIsFPS_CALL() && $uBody.getsFpsResult().equals("Y")) &&
       		(!($uBody.getLST_SSCODE_VMS().contains($uBody.getsSscode())) && ($uBody.getsIpasResult().equals("Y"))) ||
       		($uBody.getsVmsAccess().equals("00") && $uBody.getsVmsResult().equals("Y")))) {
       		$uBody.setsMutualConnType("0");
        
       		if ($uBody.isbIsVISUAL_CALL()) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VS2KTF");
       		} else {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "KTF2KT");
       		}
      	}

		// RBMS_20150726201256.xml
     	// if (($uBody.bIsNORMAL_COMP) &&
     	// (!($uBody.sSettlFileName == "INT" || $uBody.sSettlFileName == "INN") ||
		// $uBody.sSettlFileName == "KTF" || $uBody.bIsKTF_CSUB) &&
     	// (!($uBody.bIsFPS_CALL && $uBody.sFpsResult == "Y"))) {
         
     	// $uBody.sMutualConnType = "3";
     	// $uBody.sOtrFlag = "Y";

     	// if (listFindIndex(LST_SSCODE_CF, i, i == $uBody.sSscode) > -1) {
     	// if ($uBody.bIsVISUAL_CALL) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VS2OTR";
     	// }
     	// else {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "KT2OTR";
     	// }
     	// }
     	// }
      	if (($uBody.isbIsNORMAL_COMP()) &&
       		(!($uBody.getsSettlFileName().equals("INT") || $uBody.getsSettlFileName().equals("INN")) || $uBody.getsSettlFileName().equals("KTF") || $uBody.isbIsKTF_CSUB()) &&
       		(!($uBody.isbIsFPS_CALL() && $uBody.getsFpsResult().equals("Y")))) {
       
       		$uBody.setsMutualConnType("3");
       		$uBody.setsOtrFlag("Y");
       
       		if ($uBody.getLST_SSCODE_CF().contains($uBody.getsSscode())) {
        		if ($uBody.isbIsVISUAL_CALL()) {
         			$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VS2KTF");
        		} else {
         			$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "KTF2KT");
        		}
       		}
      	}

     	// if ($uBody.bIsNORMAL_COMP && $uBody.bIsVOLTE_4G_CALL) {
     	// if ($uBody.sInNetCallYn == "Y") {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "KTF2KT";
     	// } else {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "KT2OTR";
     	// }
     	// }
      	if ($uBody.isbIsNORMAL_COMP() && $uBody.isbIsVOLTE_4G_CALL()) {
       		if ($uBody.getsInNetCallYn().equals("Y")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "KTF2KT");
       		} else if ($uBody.getsInNetCallYn().equals("N")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "KT2OTR");
       		}
   		}
     	// Rule : mps_feature_code_smsbg
     	// if ($uBody.sWinSvcType == SMSBG_CALL) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "SMSBG ";
     	// }
      	if ($uBody.getsWinSvcType().equals($uBody.getSmsbgCall())) {
       		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "SMSBG");
      	}

     	// Rule : mps_feature_code_vms
     	// if (($uBody.bIsNORMAL_COMP) && ($uBody.sSettlFileName == "KTF" ||
		// $uBody.bIsKTF_CSUB) &&
     	// (listFindIndex(LST_SSCODE_VMS, i, i == $uBody.sSscode) > -1) &&
     	// ($uBody.sIpasResult == "Y") || (($uBody.sVmsAccess == "00") &&
		// ($uBody.sVmsResult == "Y"))) {

     	// $uBody.sMutualConnType = "0";

     	// if ($uBody.bIsVISUAL_CALL) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VS2VMS";
     	// }
     	// else {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VC2VMS";
     	// }
     	// }
      	if (($uBody.isbIsNORMAL_COMP()) && ($uBody.getsSettlFileName().equals("KTF") || $uBody.isbIsKTF_CSUB()) &&
       		($uBody.getLST_SSCODE_VMS().contains($uBody.getsSscode()) &&
       		($uBody.getsIpasResult().equals("Y")) || (($uBody.getsVmsAccess().equals("00")) && ($uBody.getsVmsResult().equals("Y"))))) {
       
       		$uBody.setsMutualConnType("0");
       
       		if ($uBody.isbIsVISUAL_CALL()) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VS2VMS");
       		} else {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VC2VMS");
       		}
      	}
      	

     	// Work.recv_cnt

      	// Rule : service_feature_code
     	// if ($uBody.sProdFromatId != null && $uBody.sProdCdType != null &&
		// $uBody.sProdNumber != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, $uBody.sProdCdType,
		// $uBody.sProdNumber, sCallStartDateTime);
         
     	// if (uTB_FEATR_BAS.lRowCnt > 0) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd +
		// comnPadChr(uTB_FEATR_BAS.sFeatureCd, 6, " ", "R");
     	// }
     	// }
      	if($uBody.getsProdFormatId() != null && $uBody.getsProdCdType() != null && $uBody.getsProdNumber() != null) {
       		TbFeatrBasInfo tbFeatrBas = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), $uBody.getsProdCdType(), $uBody.getsProdNumber(), $uBody.getsCallStartDateTime());
       
       		if (tbFeatrBas != null) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + comnPadChr(tbFeatrBas.getsFeatureCd(), 6, " ", "R"));
       		}
      	}
      
     	// if (($uBody.bIsTIME_CDR || $uBody.bIsTIME_CDR_001) &&
		// !($uBody.bIsVS_3G_CALL || $uBody.bIsVS_4G_CALL) && !($uBody.sInNetCallYn
		// == "Y")) {
     	// $uBody.sSettCall = "Y";
     	// }
      	if (($uBody.isbIsTIME_CDR() || $uBody.isbIsTIME_CDR_001()) && !($uBody.isbIsVS_3G_CALL() || $uBody.isbIsVS_4G_CALL()) && !($uBody.getsInNetCallYn().equals("Y"))) {
       		$uBody.setsSettCall("Y");
      	}
     	// Rule : sett_no_gen_win
     	// if ($uBody.sProdFromatId != null && $uBody.sInsProdType != null &&
		// $uBody.sWinSvcType != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS_2 =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, $uBody.sInsProdType,
		// $uBody.sWinSvcType, sCallStartDateTime);
     	// if (uTB_FEATR_BAS_2.lRowCnt > 0) {
     	// $uBody.sProdDropCall = uTB_FEATR_BAS_2.sFeatureDropIndi;

     	// if ($uBody.sProdDropCall == "Y") {
     	// $uBody.sSettCall = "Y";
     	// }
     	// }
     	// }
      	if($uBody.getsProdFormatId() != null && $uBody.getsInsProdType() != null && $uBody.getsWinSvcType() != null) {
       		TbFeatrBasInfo tbFeatrBas = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), $uBody.getsInsProdType(), $uBody.getsWinSvcType(), $uBody.getsCallStartDateTime()); 
       
       		if (tbFeatrBas != null) {
        		$uBody.setsProdDropCall(tbFeatrBas.getsFeatureDropIndi());
        
        		if ($uBody.getsProdDropCall().equals("Y")) {
         			$uBody.setsSettCall("Y");
        		}
       		}
      	}
    	
     	// Rule : sett_not_gen
     	// if (($uBody.bIsWIN_CHARGEABLE) && !($uBody.bIsINTERNATIONAL) &&
		// ($uBody.sSpnDpClInd == "Y")) {
     	// $uBody.sSettCall = "N";
     	// }
      	if (($uBody.isbIsWIN_CHARGEABLE()) && !($uBody.isbIsINTERNATIONAL()) && ($uBody.getsSpnDpClInd().equals("Y"))) {
       		$uBody.setsSettCall("N");
      	}
     	// Rule : tb_cln_sett_drop_ind
     	// if (($uBody.bIsNORMAL_COMP) && ($uBody.sCallingDropIndi == "Y")) {
  		//
     	// TB_CAL_NO_BAS_Intl uTB_CAL_NO_BAS =
		// get_TB_CAL_NO_BAS(strSubstring($uBody.sChrgSvcNo, 0, 3),
		// strSubstring($uBody.sChrgSvcNo, 3, 7), strSubstring($uBody.sChrgSvcNo,
		// 7, 11), sCallStartDateTime);
     	//    
     	// if (uTB_CAL_NO_BAS.lRowCnt > 0) {
     	// if (uTB_CAL_NO_BAS.sSettlDropInd == "Y") {
     	// $uBody.sSettDropInd = "Y";
     	// }
     	// }
     	// }
      
      	if($uBody.isbIsNORMAL_COMP() && ($uBody.getsCallingDropIndi().equals("Y"))) {
       		if ($uBody.getsChrgSvcNo() != null) {
        		TbCalNoBasInfo tbCalNoBas = audit.get_TB_CAL_NO_BAS($uBody.getsChrgSvcNo().substring(0, 3), $uBody.getsChrgSvcNo().substring(3, 7), $uBody.getsChrgSvcNo().substring(7,11), $uBody.getsCallStartDateTime());
       
        		if (tbCalNoBas != null) {
         			if (tbCalNoBas.getsSettlDropInd().equals("Y")) {
          				$uBody.setsSettDropInd("Y");
         			}
        		}
       		}
      	}
      
     	// Rule : tb_cln_sett_drop_ind
     	// if (($uBody.bIsNORMAL_COMP) && ($uBody.sCallingDropIndi == "Y")) {
  		//
     	// TB_CAL_NO_BAS_Intl uTB_CAL_NO_BAS =
		// get_TB_CAL_NO_BAS(strSubstring($uBody.sChrgSvcNo, 0, 3),
		// strSubstring($uBody.sChrgSvcNo, 3, 7), strSubstring($uBody.sChrgSvcNo,
		// 7, 11), sCallStartDateTime);
     	//    
     	// if (uTB_CAL_NO_BAS.lRowCnt > 0) {
     	// if (uTB_CAL_NO_BAS.sSettlDropInd == "Y") {
     	// $uBody.sSettDropInd = "Y";
     	// }
     	// }
     	// }
      	if($uBody.isbIsNORMAL_COMP() && ($uBody.getsCallingDropIndi().equals("Y"))) {
       		TbCalNoBasInfo tbCalNoBas = audit.get_TB_CAL_NO_BAS($uBody.getsChrgSvcNo().substring(0, 3), $uBody.getsChrgSvcNo().substring(3, 7), $uBody.getsChrgSvcNo().substring(7,11), $uBody.getsCallStartDateTime());
       
       		if (tbCalNoBas != null) {
        		if (tbCalNoBas.getsSettlDropInd().equals("Y")) {
         			$uBody.setsSettDropInd("Y");
        		}
       		}
      	}      
     	// Rule : tb_mff_service_feature
     	// string sDropIndi;
     	// if ($uBody.sProdFromatId != null && $uBody.sProdCdType != null &&
		// $uBody.sSscode != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS_3 =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, $uBody.sProdCdType,
		// $uBody.sSscode, sCallStartDateTime);
     	// if (uTB_FEATR_BAS_3.lRowCnt > 0) {
     	// sDropIndi = uTB_FEATR_BAS_3.sFeatureDropIndi;
     	// }
     	// }
      	String sDropIndi = "";
      	if ($uBody.getsProdFormatId() != null && $uBody.getsProdCdType() != null && $uBody.getsSscode() != null) {
       		TbFeatrBasInfo tbFeatrBas = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), $uBody.getsProdCdType(), $uBody.getsSscode(), $uBody.getsCallStartDateTime());
       		if (tbFeatrBas != null) {
        		sDropIndi = tbFeatrBas.getsFeatureDropIndi();
       		}
      	}
     	// if (($uBody.bIsNORMAL_COMP) && ($uBody.sProdCdIndi == "Y") &&
		// (sDropIndi == "N")) {
     	// $uBody.sProdDropCall = "N";

     	// if (!($uBody.sSscode == "066")) {
     	// if ($uBody.sProdFromatId != null && $uBody.sProdCdType != null &&
		// $uBody.sSscode != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS_4 =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, $uBody.sProdCdType,
		// $uBody.sSscode, sCallStartDateTime);
     
     	// if (uTB_FEATR_BAS_4.lRowCnt > 0) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd +
		// comnPadChr(uTB_FEATR_BAS_4.sFeatureCd, 6, " ", "R");
     	// }
     	// }
     	// }
     	// }
      	if (($uBody.isbIsNORMAL_COMP()) && ($uBody.getsProdCdIndi().equals("Y")) && (sDropIndi.equals("N"))) {
       		$uBody.setsProdDropCall("N");
       
       		if (!($uBody.getsSscode().equals("066"))) {
        		if ($uBody.getsProdFormatId() != null && $uBody.getsProdCdType() != null && $uBody.getsSscode() != null) {
         			TbFeatrBasInfo tbFeatrBas = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), $uBody.getsProdCdType(), $uBody.getsSscode(), $uBody.getsCallStartDateTime());
       
         			if (tbFeatrBas != null) {
          				$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + comnPadChr(tbFeatrBas.getsFeatureCd(), 6, " ", "R"));
         			}
        		}
       		}
      	}
  		// Rule : tb_mff_sett_drop_ind
     	// string sFeatureSettDropIndi;
     	// if ($uBody.sProdFromatId != null && $uBody.sProdCdType != null &&
		// $uBody.sSscode != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS_5 =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, $uBody.sProdCdType,
		// $uBody.sSscode, sCallStartDateTime);
     	// if (uTB_FEATR_BAS_5.lRowCnt > 0) {
     	// sFeatureSettDropIndi = uTB_FEATR_BAS_5.sSettlDropIndi;
     	// }
     	// }
     
      	String sFeatureSettDropIndi = "";
      	if ($uBody.getsProdFormatId() != null && $uBody.getsProdCdType() != null && $uBody.getsSscode() != null) {
       		TbFeatrBasInfo tbFeatrBas = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), $uBody.getsProdCdType(), $uBody.getsSscode(), $uBody.getsCallStartDateTime());
       
       		if (tbFeatrBas != null) {
        		sFeatureSettDropIndi = tbFeatrBas.getsSettlDropIndi();
       		}
      	}

     	// if (($uBody.bIsNORMAL_COMP) && ($uBody.sProdCdIndi == "Y") &&
		// (sFeatureSettDropIndi == "Y")) {
     	// $uBody.sSettDropInd = "Y";
     	// }
      	if (($uBody.isbIsNORMAL_COMP()) && ($uBody.getsProdCdIndi().equals("Y")) && (sFeatureSettDropIndi.equals("Y"))) {
       		$uBody.setsSettDropInd("Y");
      	}

		// RBMS_20150726201256.xml
     	// TB_WLESS_SPCL_NO_BAS_Intl uTB_WLESS_SPCL_NO_BAS_10 =
		// get_TB_WLESS_SPCL_NO_BAS($uBody.sCalledArea, $uBody.sChrgOtherNo,
		// "KTF", sCallStartDateTime, SPNM);
  		WlessSpclNoBasInfo tbWlessSpclNoBas = audit.get_TB_WLESS_SPCL_NO_BAS($uBody.getsCalledArea(), $uBody.getsChrgOtherNo(), "KTF", $uBody.getsCallStartDateTime(), $uBody.getSpnm());
     	// if (($uBody.bIsNORMAL_COMP) && ($uBody.sSpIndi == "Y") &&
		// !($uBody.bIsINTERNATIONAL) && ($uBody.sSpnAtFtrInd == "Y")) {
     
     	// if (uTB_WLESS_SPCL_NO_BAS_10.lRowCnt > 0) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd +
		// comnPadChr(uTB_WLESS_SPCL_NO_BAS_10.sAirtimeFeatureCd, 6, " ", "R");
     	// }
     	// }
      	if (($uBody.isbIsNORMAL_COMP()) && ($uBody.getsSpIndi().equals("Y")) && !($uBody.isbIsINTERNATIONAL()) && ($uBody.getsSpnAtFtrInd().equals("Y"))) {
       		if (tbWlessSpclNoBas != null) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + comnPadChr(tbWlessSpclNoBas.getsAirtimeFeatureCd(), 6, " ", "R"));
       		}
      	}

     	// Rule : tb_spn_sp_feature_code
     	// if (($uBody.bIsNORMAL_COMP) && ($uBody.sSpIndi == "Y") &&
		// ($uBody.sSpnSpInd == "Y")) {
     	// $uBody.sSpProdCd = uTB_WLESS_SPCL_NO_BAS_10.sSpFeatureCode;
     	// }
     	if (($uBody.isbIsNORMAL_COMP()) && ($uBody.getsSpIndi().equals("Y")) && ($uBody.getsSpnSpInd().equals("Y"))) {
       		$uBody.setsSpProdCd(tbWlessSpclNoBas.getsSpFeatureCode());
      	}

     	// Rule : tb_spn_sp_type
     	// if (($uBody.bIsNORMAL_COMP) && ($uBody.sSpIndi == "Y") &&
		// ($uBody.sSpnSpInd == "Y")) {
     
     	// TB_SVC_PRVR_BAS_Intl uTB_SVC_PRVR_BAS =
		// get_TB_SVC_PRVR_BAS(uTB_WLESS_SPCL_NO_BAS_10.sIspId);
     	// $uBody.sSpType = uTB_SVC_PRVR_BAS.sSpFeatureCode;

     	// }
      	if (($uBody.isbIsNORMAL_COMP()) && ($uBody.getsSpIndi().equals("Y")) && ($uBody.getsSpnSpInd().equals("Y"))) {
       		TbSvcPrvrBasInfo tbSvcPrvrBas = audit.get_TB_SVC_PRVR_BAS(tbWlessSpclNoBas.getsIspId());
       		$uBody.setsSpType(tbSvcPrvrBas.getsSpFeatureCode());
      	}


     	// Rule : tb_spn_special_number_id
     	// if (($uBody.bIsNORMAL_COMP) && ($uBody.sSpIndi == "Y")) {
     	// $uBody.iSpecialNoId = (int)uTB_WLESS_SPCL_NO_BAS_10.lSpecialNoId;
     	// }
      	if (($uBody.isbIsNORMAL_COMP()) && ($uBody.getsSpIndi().equals("Y"))) {
       		$uBody.setiSpecialNoId(Integer.parseInt(tbWlessSpclNoBas.getlSpecialNoId().equals("") ? "0" : tbWlessSpclNoBas.getlSpecialNoId()));
	    }
      
     	// if ($uBody.sProdFromatId != null && $uBody.sInsProdType != null &&
		// $uBody.sWinSvcType != null) {
     	// TB_FEATR_BAS_Intl uTB_FEATR_BAS_6 =
		// get_TB_FEATR_BAS($uBody.sProdFromatId, $uBody.sInsProdType,
		// $uBody.sWinSvcType, sCallStartDateTime);
     
     	// if (uTB_FEATR_BAS_6.lRowCnt > 0) {
     	// if ((uTB_FEATR_BAS_6.sFeatureType == "C") && ($uBody.bIsWIN_CDR)) {
     	// $uBody.bIsWIN_CHARGED = true;
     	// }
     	// }
     	// }
      	if ($uBody.getsProdFormatId() != null && $uBody.getsInsProdType() != null && $uBody.getsWinSvcType() != null) {
       		TbFeatrBasInfo tbFeatrBas = audit.get_TB_FEATR_BAS($uBody.getsProdFormatId(), $uBody.getsInsProdType(), $uBody.getsWinSvcType(), $uBody.getsCallStartDateTime());
       
       		if (tbFeatrBas != null) {
        		if((tbFeatrBas.getsFeatureType().equals("C")) && $uBody.isbIsWIN_CDR()) {
         			$uBody.setbIsWIN_CHARGED(true);
        		}
       		}
      	}   
      	

     	// int iDeductTime;
      	int iDeductTime = 0;

     	// Rule : visual_duration
     	// if (($uBody.bIsPSVT_3G_CALL || $uBody.bIsPSVT_4G_CALL) &&
		// !($uBody.bIsWIN_CHARGED)) {
     	// $uBody.sDeduct = "Y";

     	// TB_PROF_BAS_Intl uTB_PROF_BAS_4 = get_TB_PROF_BAS("PSVT_DEDUCT_TIME",
		// "VOLTE", sCallStartDateTime);

     	// if (!(uTB_PROF_BAS_4 == null)) {
     	// $uBody.sFpsResult = uTB_PROF_BAS_4.sReturnValue;
     	// }
     	// strToInt(iDeductTime, $uBody.sFpsResult);

     	// $uBody.iDeductUseTime = $uBody.iDeductUseTime + iDeductTime;
     	// $uBody.iUseTime = $uBody.iUseTime - $uBody.iDeductUseTime;
     	// }
      	if (($uBody.isbIsPSVT_3G_CALL() || $uBody.isbIsPSVT_4G_CALL()) && !($uBody.isbIsWIN_CHARGED())) {
       		$uBody.setsDeduct("Y");
       
       		TbProfBasInfo tbProfBas = audit.get_TB_PROF_BAS("PSVT_DEDUCT_TIME", "VOLTE", $uBody.getsCallStartDateTime());
       
       		if (tbProfBas != null) {
        		$uBody.setsFpsResult(tbProfBas.getsReturnvalue());
       		}

       		iDeductTime = Integer.parseInt($uBody.getsFpsResult().equals("") ? "0" : $uBody.getsFpsResult());

       
       		$uBody.setiDeductUseTime($uBody.getiDeductUseTime() + iDeductTime);
       		$uBody.setiUseTime($uBody.getiUseTime() - $uBody.getiDeductUseTime());
      	}

     	// Rule : volte_duration
     	// if ($uBody.bIsVOLTE_4G_CALL) {
     	// $uBody.sDeduct = "Y";

     	// TB_PROF_BAS_Intl uTB_PROF_BAS_5 =
		// get_TB_PROF_BAS("VoLTE_DEDUCT_TIME", "VOLTE", sCallStartDateTime);

     	// if (!(uTB_PROF_BAS_5 == null)) {
     	// $uBody.sFpsResult = uTB_PROF_BAS_5.sReturnValue;
     	// }
     	// strToInt(iDeductTime, $uBody.sFpsResult);

     	// $uBody.iDeductUseTime = $uBody.iDeductUseTime + iDeductTime;
     	// $uBody.iUseTime = $uBody.iUseTime - $uBody.iDeductUseTime;
     	// }
     
      	if ($uBody.isbIsVOLTE_4G_CALL()) {
       		$uBody.setsDeduct("Y");
       
       		TbProfBasInfo tbProfBas = audit.get_TB_PROF_BAS("VoLTE_DEDUCT_TIME", "VOLTE", $uBody.getsCallStartDateTime());
       
       		if (tbProfBas != null) {
        		$uBody.setsFpsResult(tbProfBas.getsReturnvalue());
       		}
       		iDeductTime = Integer.parseInt($uBody.getsFpsResult().equals("") ? "0" : $uBody.getsFpsResult());
       
       		$uBody.setiDeductUseTime($uBody.getiDeductUseTime() + iDeductTime);
       		$uBody.setiUseTime($uBody.getiUseTime() - $uBody.getiDeductUseTime());
      	}
       

     	// Rule : vs_vmsfw_duration
     	// Rule : vs_vmsfw_duration_2
     	// if (($uBody.bIsNORMAL_COMP) && (($uBody.sSettlFileName == "KTF") ||
		// ($uBody.bIsKTF_CSUB)) && ($uBody.bIsVISUAL_CALL) &&
     	// ((($uBody.sSscode == SSCODE_VMSFW) && ($uBody.sIpasResult == "Y")) ||
     	// (($uBody.sVmsAccess == "00") && ($uBody.sVmsResult == "Y")))) {

     	// if (!($uBody.bIsWIN_CHARGED)) { // Rule : vs_vmsfw_duration
     	// $uBody.sDeduct = "Y";
     	// $uBody.sVmsDivision = "00";

     	// TB_PROF_BAS_Intl uTB_PROF_BAS_6 = get_TB_PROF_BAS("VMSFW_INIT_TIME",
		// "VOLTE", sCallStartDateTime);

     	// if (!(uTB_PROF_BAS_6 == null)) {
     	// $uBody.sFpsResult = uTB_PROF_BAS_6.sReturnValue;
     	// }
     	// strToInt(iDeductTime, $uBody.sFpsResult);

     	// $uBody.iDeductUseTime = $uBody.iDeductUseTime + iDeductTime;
     	// $uBody.iUseTime = $uBody.iUseTime - $uBody.iDeductUseTime;

     	// $uBody.sMpsFeatureCd = strREReplaceAll($uBody.sMpsFeatureCd, "VMSFW ",
		// "VMSFW ");
     	// }
     	// else { // Rule : vs_vmsfw_duration_2 -- (VOLTE.WIN_CHARGED)
     	// $uBody.sMpsFeatureCd = strREReplaceAll($uBody.sMpsFeatureCd, "VMSFW ",
		// "VMSFW ");
     	// }
     	// }
     
      	if (($uBody.isbIsNORMAL_COMP()) && (($uBody.getsSettlFileName().equals("KTF")) || ($uBody.isbIsKTF_CSUB()) && ($uBody.isbIsVISUAL_CALL())) && (($uBody.getsVmsAccess().equals("00")) 
       		&& ($uBody.getsVmsResult().equals("Y")))) {
       		if (!($uBody.isbIsWIN_CHARGED())) {
        		$uBody.setsDeduct("Y");
        
        		TbProfBasInfo tbProfBas = audit.get_TB_PROF_BAS("VMSFW_INIT_TIME", "VOLTE", $uBody.getsCallStartDateTime());
        
        		if (tbProfBas != null) {
        			$uBody.setsFpsResult(tbProfBas.getsReturnvalue());
        		}
        		iDeductTime = Integer.parseInt($uBody.getsFpsResult().equals("") ? "0" : $uBody.getsFpsResult());
        
        		$uBody.setiDeductUseTime($uBody.getiDeductUseTime() + iDeductTime);
        		$uBody.setiUseTime($uBody.getiUseTime() - $uBody.getiDeductUseTime());
        
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd().replace("VMSFW ", "VMSFW "));
       		} else {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd().replace("VMSFW ", "VMSFW "));
       		}
      	}

		// Rule : vs_vmsfw_duration_otr
     	// if (((uBody.bIsNORMAL_COMP) && !((uBody.sSettlFileName == "KTF") ||
		// (uBody.bIsKTF_CSUB)) && (uBody.sVmsAccess == "01" || uBody.sVmsAccess
		// == "02")) && (uBody.bIsVISUAL_CALL) && (uBody.sVmsResult == "Y")) {
     	// if (!(uBody.bIsWIN_CHARGED)) {
     	// uBody.sDeduct = "Y";
     	// uBody.sVmsDivision = uBody.sVmsAccess;

     	// TB_PROF_BAS_Intl uTB_PROF_BAS_7 = get_TB_PROF_BAS("VMSFW_INIT_TIME",
		// "VOLTE", sCallStartDateTime);

     	// if (!(uTB_PROF_BAS_7 == null)) {
     	// uBody.sFpsResult = uTB_PROF_BAS_7.sReturnValue;
     	// }
     	// strToInt(iDeductTime, uBody.sFpsResult);

     	// uBody.iDeductUseTime = uBody.iDeductUseTime + iDeductTime;
     	// uBody.iUseTime = uBody.iUseTime - uBody.iDeductUseTime;

     	// uBody.sMpsFeatureCd = uBody.sMpsFeatureCd + "VMSFW ";
     	// }
     	// else { // (VOLTE.WIN_CHARGED)
     	// uBody.sMpsFeatureCd = uBody.sMpsFeatureCd + "VMSFW ";
     	// }

     	// }
     
      	if ((($uBody.isbIsNORMAL_COMP()) && !(($uBody.getsSettlFileName().equals("KTF")) || ($uBody.isbIsKTF_CSUB())) && ($uBody.getsVmsAccess().equals("01") || $uBody.getsVmsAccess().equals("02"))) && ($uBody.isbIsVISUAL_CALL()) 
      		&& ($uBody.getsVmsResult().equals("Y"))) {
       		if (!($uBody.isbIsWIN_CHARGED())) {
        		$uBody.setsDeduct("Y");
        
        		TbProfBasInfo tbProfBas = audit.get_TB_PROF_BAS("VMSFW_INIT_TIME", "VOLTE", $uBody.getsCallStartDateTime());
        
        		if (tbProfBas != null) {
         			$uBody.setsFpsResult(tbProfBas.getsReturnvalue());
        		}
        		iDeductTime = Integer.parseInt($uBody.getsFpsResult().equals("") ? "0" : $uBody.getsFpsResult());
       
        		$uBody.setiDeductUseTime($uBody.getiDeductUseTime() + iDeductTime);
        		$uBody.setiUseTime($uBody.getiUseTime() - $uBody.getiDeductUseTime());
        
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VMSFW ");
       		} else {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VMSFW ");
       		}
      	}

     	// if ($uBody.bIsNORMAL_COMP && ($uBody.sSscode == SSCODE_FREE_ZONE)) {
     	// $uBody.sSettCall = "N";
     	// $uBody.sMutualConnType = "0";

     	// if ($uBody.bIsPSVT_3G_CALL || $uBody.bIsPSVT_4G_CALL) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VS2FZ ";
     	// } else if ($uBody.bIsVOLTE_4G_CALL) {
     	// $uBody.sMpsFeatureCd = $uBody.sMpsFeatureCd + "VC2FZ ";
     	// }
     	// }
     
      	if ($uBody.isbIsNORMAL_COMP() && ($uBody.getsSscode().equals($uBody.getSscodeFreeZone()))) {
       		$uBody.setsSettCall("N");
       		$uBody.setsMutualConnType("0");
       
       		if ($uBody.isbIsPSVT_3G_CALL() || $uBody.isbIsPSVT_4G_CALL()) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VS2FZ ");
       		} else if ($uBody.isbIsVOLTE_4G_CALL()) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VC2FZ ");
       		}
      	}


     	// VOLTE.TWONUMBER_MO -- NOT(VOLTE.calling_asserted_identity is SPACE)
     	// if (!($uBody.calling_asserted_identity == null ||
		// strTrim($uBody.calling_asserted_identity) == "")) {
     	// $uBody.bIsTWONUMBER_MO = true;
     	// }
      	if (!($uBody.getCalling_asserted_identity() != null || $uBody.getCalling_asserted_identity().trim().equals(""))) {
       		$uBody.setbIsTWONUMBER_MO(true);
      	}

     	// list<string> ltFeatureCode = listCreate(string);
     	// int iFeatureCnt = comnStrLength($uBody.sMpsFeatureCd);
     	// int i = 0;
     	// while (i < iFeatureCnt) {
     	// listAdd(ltFeatureCode,comnSubstring($uBody.sMpsFeatureCd, i, i+6));
     	// i = i+6;
     	// }
      	// ArrayList<String> ltFeatureCode = new ArrayList<String>();
      	ArrayList ltFeatureCode = new ArrayList();
      
      	for (int i=0; i<$uBody.getsMpsFeatureCd().length(); i=i+6) {
       		ltFeatureCode.add(CommonUtils.comnSubstring($uBody.getsMpsFeatureCd(), i, i+6));
      	} 

     	
      	if (($uBody.getsSscode().equals($uBody.getSscodeTwonumber()) && $uBody.isbIsTWONUMBER_MO())) {
       		if (ltFeatureCode.contains("KTF2KT") || ltFeatureCode.contains("VLT2LK") || ltFeatureCode.contains("VLT2KT")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "KTFKTT");
       		}
       		if (ltFeatureCode.contains("KT2OTR") || ltFeatureCode.contains("VLT2LO") || ltFeatureCode.contains("VLT2OT")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "KTOTRT");
       		}
       		if (ltFeatureCode.contains("VS2KTF") || ltFeatureCode.contains("PVL2LK") || ltFeatureCode.contains("PVL2KT") || ltFeatureCode.contains("PVW2KT")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VSKTFT");
       		}
       		if (ltFeatureCode.contains("VS2OTR") || ltFeatureCode.contains("PVL2LO") || ltFeatureCode.contains("PVL2OT") || ltFeatureCode.contains("PVW2OT")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VSOTRT");
       		}
       		if (ltFeatureCode.contains("FPVCKF")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "FPCKFT");
       		}
       		if (ltFeatureCode.contains("FPVCOT")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "FPCOTT");
       		}
       		if (ltFeatureCode.contains("FPVSKF")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "FPSKFT");
       		}
       		if (ltFeatureCode.contains("FPVSOT")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "FPSOTT");
       		}
       		if (ltFeatureCode.contains("VC2KTF")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VCKTFT");
       		}
       		if (ltFeatureCode.contains("VC2OTR")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VCOTRT");
       		}
       		if (ltFeatureCode.contains("VC2VMS")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VCVMST");
       		}
       		if (ltFeatureCode.contains("VS2VMS")) {
        		$uBody.setsMpsFeatureCd($uBody.getsMpsFeatureCd() + "VSVMST");
       		}
   		}      
   		// $uBody.bIsChargeFeaturesAir = isFeatureCheck($uBody.sMpsFeatureCd, "AIR");
     	// $uBody.bIsChargeFeaturesOther = isFeatureCheck($uBody.sMpsFeatureCd,
		// "AC");
      	$uBody.setbIsChargeFeaturesAir($uBody.getsMpsFeatureCd().contains("AIR"));
      	$uBody.setbIsChargeFeaturesOther($uBody.getsMpsFeatureCd().contains("AC"));  	   	
end